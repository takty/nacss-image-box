window.NACSS=window.NACSS||{},window.NACSS.viewer=window.NACSS.viewer||{},(e=>{function t(e,t=!0){let n=2166136261;for(let t=0;t<e.length;t+=1)n^=e.charCodeAt(t),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);if(t){const e="0000000"+(n>>>0).toString(16);return e.substring(e.length-8)}return n>>>0}const n=new Map;function s(e,t,n=!0,s=""){const o=t.substr(1);if(t.startsWith(":"))n?e.dataset[o]=s:delete e.dataset[o];else{const t=[o,s].join("-");n?e.classList.add(t):e.classList.remove(t)}}function o(e){const t=window.pageXOffset,n=window.pageYOffset;let s=0,o=0;return 1===e.length?(s=e[0].pageX-t,o=e[0].pageY-n):2<=e.length&&(s=(e[0].pageX+e[1].pageX)/2-t,o=(e[0].pageY+e[1].pageY)/2-n),[s,o]}function i(e){return[e.pageX-window.pageXOffset,e.pageY-window.pageYOffset]}const l=[];function a(e,t=!1){t&&e(),l.push(function(e){let t;return(...n)=>{t||(t=!0,requestAnimationFrame((()=>{t=!1,e(...n)})))}}(e))}function r(e){const t=e.frm.offsetWidth/e.frm.offsetHeight,n=e.img.offsetWidth/e.img.offsetHeight;e.isLs=t<n;const s=getComputedStyle(e.img);e.margin=2*parseInt(s.outlineWidth);const o=e.img.style;o.minWidth="",o.minHeight="",e.isLs?(o.width=`calc(100% - ${e.margin}px)`,o.height="auto"):(o.width="auto",o.height=`calc(100% - ${e.margin}px)`,o.maxWidth="none"),e.baseSize=e.isLs?e.frm.clientWidth:e.frm.clientHeight;const i=e.isLs?e.img.naturalWidth:e.img.naturalHeight;e.realScale=i/e.baseSize,e.scale=1,d(e.frm,e.img)}function c(e,t){e.scale=Math.max(1,Math.min(e.opts.maxZoomRate,t));const n=e.baseSize*e.scale-e.margin+"px";e.isLs?e.img.style.minWidth=n:e.img.style.minHeight=n,d(e.frm,e.img)}function d(e,t){const n=t.offsetWidth,s=t.offsetHeight,o=e.clientWidth,i=e.clientHeight,l=t.style;l.left=n<o?(o-n)/2+"px":0,l.top=s<i?(i-s)/2+"px":0}function p(e,t,n){if(0!==location.hash.indexOf("#"+t))return;const s=n.replace("#"+t,"");if(s)for(const[t,n]of e)if(t===s){null!==f&&f!==t&&m(e.get(f)),null!==f&&f===t||g(n);break}}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const e of l)e()}),{passive:!0})})),e.applyImage=function(e,l={}){if(0===e.length)return;l=Object.assign({styleOpener:":ncViewerOpener",styleOpenerWrapper:":ncViewerOpenerWrapper"},l);!function(e,t={}){if(0===e.length)return;t=Object.assign({styleRoot:":ncViewer",styleCloser:":ncViewerCloser",stylePrev:":ncViewerPrev",styleNext:":ncViewerNext",styleCaption:":ncViewerCaption",styleOpen:":ncOpen",styleVisible:":ncVisible",styleInstantly:":ncInstantly",hashPrefix:"viewer:"},t);const n=new Map;let s=null;for(const o of e){const e=u(t,o.id,o.frameInst,o.frame,o.caption,s);o.opener.addEventListener("click",(t=>h(e,t))),n.set(o.id,e),s=e}(function(e){a((()=>{for(const t of e.values())t.fi.doResize();setTimeout((()=>{for(const t of e.values())t.fi.doResize()}),200)})),window.addEventListener("keydown",(t=>{if(null!==f&&!t.altKey&&!t.ctrlKey&&!t.shiftKey){const n=e.get(f);"Escape"===t.key?n.dlg.click():"ArrowLeft"===t.key?n.btnPrev.click():"ArrowRight"===t.key&&n.btnNext.click()}}))})(n),function(e,t){window.addEventListener("popstate",(t=>{null!==f&&e.has(f)&&m(e.get(f)),t.state&&"nc-viewer"===t.state.name&&void 0!==t.state.id&&e.has(t.state.id)&&g(e.get(t.state.id))})),window.addEventListener("hashchange",(()=>p(e,t,location.hash))),p(e,t,location.hash)}(n,t.hashPrefix)}(e.map((e=>{const a=function(e,s=!0){if(n.has(e)){const o=n.get(e);return n.set(e,o+1),t(e+o,s)}return n.set(e,1),t(e,s)}(e.href),[d,p]=function(e,t){e=Object.assign({styleImageFrame:":ncFrameImage",styleLoaded:":ncLoaded",maxZoomRate:10},e);const n={opts:e,src:t,scale:1,realScale:1,baseSize:null,isLs:!1,margin:0,frm:null,img:null};return n.frm=document.createElement("div"),s(n.frm,n.opts.styleImageFrame),n.img=document.createElement("img"),n.img.addEventListener("click",(e=>e.stopPropagation())),n.frm.appendChild(n.img),function(e,t){let n=0,s=0,o=!1;function l(n,s){n.stopPropagation(),n.preventDefault();const[o,l]=i(n),a=(o+t.scrollLeft)/e.scale,r=(l+t.scrollTop)/e.scale;c(e,s),t.scrollLeft=a*e.scale-o,t.scrollTop=r*e.scale-l}t.addEventListener("mousedown",(e=>{e.button||(e.preventDefault(),[n,s]=i(e),o=!0)})),t.addEventListener("mousemove",(e=>{if(!o)return;e.stopPropagation(),e.preventDefault();const[l,a]=i(e);t.scrollLeft+=n-l,t.scrollTop+=s-a,n=l,s=a})),t.addEventListener("mousedrag",(e=>{o&&(e.stopPropagation(),e.preventDefault())})),t.addEventListener("mouseup",(()=>{o=!1})),t.addEventListener("wheel",(t=>{const n=0>t.deltaY?1.1:.9;l(t,e.scale*n)}),!0),t.addEventListener("dblclick",(t=>{e.realScale<1||l(t,e.scale<e.realScale?e.realScale:1)}),!0)}(n,n.frm),function(e,t){let n=0,s=0,i=0,l=0;function a(n,s){const o=t.scrollLeft,i=t.scrollTop;return[(n+o)/e.scale,(s+i)/e.scale]}function r(e){i=e.length,[n,s]=a(...o(e))}(function(e){let t=!1;window.addEventListener("touchmove",(e=>{t&&(e.preventDefault(),e.stopImmediatePropagation())}),{passive:!1}),e.addEventListener("touchstart",(()=>{t=!0})),e.addEventListener("touchend",(()=>{t=!1}))})(t),t.addEventListener("touchstart",(e=>{l=0,r(e.touches)})),t.addEventListener("touchmove",(a=>{a.preventDefault(),a.stopPropagation();const d=a.touches;i!==d.length&&r(d);const[p,f]=o(d);if(2<=d.length){const o=function(e){const t=e[0].screenX,n=e[0].screenY,s=e[1].screenX,o=e[1].screenY;return Math.sqrt(Math.pow(s-t,2)+Math.pow(o-n,2))}(d);if(l){const i=o/(l*e.scale);i&&i!==1/0&&c(e,e.scale*i),t.scrollLeft=n*e.scale-p,t.scrollTop=s*e.scale-f}l=o/e.scale}else t.scrollLeft=n*e.scale-p,t.scrollTop=s*e.scale-f}),{passive:!1})}(n,n.frm),n.doResize=()=>r(n),n.doOpen=()=>function(e){const t=e.img;t.src||(t.style.opacity="0",t.src=e.src,t.addEventListener("load",(()=>{r(e),s(e.frm,e.opts.styleLoaded),setTimeout((()=>{t.style.opacity="1"}),0)})))}(n),n.doClose=()=>{},[n,n.frm]}(l,e.href),f=function(e){if("FIGURE"===e.parentNode.tagName){const t=e.parentNode.getElementsByTagName("figcaption");if(0<t.length)return t[0].innerHTML}return null}(e);return function(e,t,n){s(e,t),"FIGURE"===e.parentNode.tagName&&s(e.parentNode,n)}(e,l.styleOpener,l.styleOpenerWrapper),{opener:e,id:a,frameInst:d,frame:p,caption:f}})),l)};let f=null;function u(e,t,n,o,i,l=null){const a={};a.opts=e,a.fi=n,a.id=t,a.dlg=document.createElement("div"),s(a.dlg,e.styleRoot),a.dlg.addEventListener("click",(e=>function(e){e.preventDefault(),history.back()}(e))),a.dlg.appendChild(o);const r=document.createElement("button");if(s(r,e.styleCloser),a.dlg.appendChild(r),a.btnPrev=document.createElement("button"),a.btnNext=document.createElement("button"),s(a.btnPrev,e.stylePrev),s(a.btnNext,e.styleNext),a.dlg.appendChild(a.btnPrev),a.dlg.appendChild(a.btnNext),i){const t=document.createElement("div");t.innerHTML=`<span>${i}</span>`,s(t,e.styleCaption),a.dlg.appendChild(t)}return document.body.appendChild(a.dlg),function(e,t){e.btnNext.style.display="none",t?(e.btnPrev.addEventListener("click",(n=>{n.stopPropagation(),m(e,!0),g(t,!0)})),function(e,t){e.btnNext.addEventListener("click",(n=>{n.stopPropagation(),m(e,!0),g(t,!0)})),e.btnNext.style.display=null}(t,e)):e.btnPrev.style.display="none"}(a,l),l=a,a}function g(e,t=!1){if(s(e.dlg,e.opts.styleOpen),e.fi.doOpen(),t){e.fi.doResize(),s(e.dlg,e.opts.styleInstantly),s(e.dlg,e.opts.styleVisible),setTimeout((()=>{s(e.dlg,e.opts.styleInstantly,!1)}),20);const t="#"+e.opts.hashPrefix+e.id;history.replaceState(null,"",t)}else setTimeout((()=>{e.fi.doResize(),s(e.dlg,e.opts.styleVisible)}),0);f=e.id;const n=getComputedStyle(document.documentElement);n.marginTop&&(e.dlg.style.top=n.marginTop)}function m(e,t=!1){e.fi.doClose(),t?(s(e.dlg,e.opts.styleInstantly),s(e.dlg,e.opts.styleVisible,!1),setTimeout((()=>{s(e.dlg,e.opts.styleInstantly,!1)}),20)):s(e.dlg,e.opts.styleVisible,!1),setTimeout((()=>{s(e.dlg,e.opts.styleOpen,!1)}),200),f=null}function h(e,t){if(t.preventDefault(),g(e),location.hash){const e=location.href.substring(0,location.href.indexOf("#"));history.replaceState(null,"",e)}const n="#"+e.opts.hashPrefix+e.id;history.pushState({name:"nc-viewer",id:e.id},null,n)}})(window.NACSS.viewer);
//# sourceMappingURL=viewer-image.min.js.map