{"version":3,"sources":["viewer.js"],"names":["window","NS","getTouchPoint","ts","pxo","pageXOffset","pyo","pageYOffset","x","y","length","pageX","pageY","getCursorPoint","e","setSize","inst","winAs","frm","offsetWidth","offsetHeight","imgAs","img","isLs","cs","getComputedStyle","margin","parseInt","outlineWidth","s","style","minWidth","minHeight","width","height","maxWidth","baseSize","clientWidth","clientHeight","nbs","naturalWidth","naturalHeight","realScale","scale","_doCenteringImage","setSource","src","opacity","addEventListener","setClass","opts","styleLoaded","setTimeout","_setScaledSize","Math","max","min","maxZoomRate","size","imgW","imgH","frmW","frmH","left","top","viewerImage","as","Object","assign","styleOpener","styleOpenerWrapper","fs","map","a","hash","calcHash","href","frameInst","frame","styleImageFrame","document","createElement","stopPropagation","appendChild","xS","yS","isMoving","zoomListener","preventDefault","cx","cy","ix","scrollLeft","iy","scrollTop","button","deltaY","_enableMouseGesture","lastTouchCount","baseDist","touchPointToImagePoint","fsx","fsy","updatePoint","f","isTouching","stopImmediatePropagation","passive","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","createImageFrame","caption","parentNode","tagName","fcs","getElementsByTagName","innerHTML","extractImageCaption","assignImageOpenerStyle","opener","initialize","ifm","hasAttribute","removeAttribute","contentDocument","location","replace","viewerIframe","os","ifms","o","i","styleIframeFrame","startsWith","url","URL","ps","URLSearchParams","search","append","toString","filterSource","setAttribute","aspectRatio","w","h","sW","sH","indexOf","extractIframeSize","contentWindow","postMessage","pause","createIframeFrame","assignIframeOpenerStyle","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","hashPrefix","is","fi","id","instanceCount","dlg","history","back","_onClose","btn","btnPrev","btnNext","divCap","body","prev","display","doClose","doOpen","next","_setNextInstance","_setAdjacentInstance","prevInstance","createViewer","newUrl","substr","replaceState","pushState","name","_onOpen","fn","doFirst","resizeListeners","push","isRunning","args","requestAnimationFrame","throttle","onResize","doResize","currentId","altKey","ctrlKey","shiftKey","cur","key","click","assignEventHandler","state","undefined","checkHash","processHash","ih","instantly","str","asHex","charCodeAt","tar","cls","enabled","val","dataset","c","join","classList","add","remove","l"],"mappings":"AAUAA,OAAM,MAAYA,OAAM,OAAa,GAGrC,SAAWC,GAEV,CAWC,SAASC,EAAcC,GACtB,MAAMC,EAAMJ,OAAOK,YAAaC,EAAMN,OAAOO,YAC7C,IAAIC,EAAI,EAAGC,EAAI,EAQf,OAPkB,IAAdN,EAAGO,QACNF,EAAIL,EAAG,GAAGQ,MAAQP,EAClBK,EAAIN,EAAG,GAAGS,MAAQN,GACR,GAAKH,EAAGO,SAClBF,GAAKL,EAAG,GAAGQ,MAAQR,EAAG,GAAGQ,OAAS,EAAIP,EACtCK,GAAKN,EAAG,GAAGS,MAAQT,EAAG,GAAGS,OAAS,EAAIN,GAEhC,CAACE,EAAGC,GAoBZ,SAASI,EAAeC,GACvB,MAAO,CAACA,EAAEH,MAAQX,OAAOK,YAAaS,EAAEF,MAAQZ,OAAOO,aA6FxD,SAASQ,EAAQC,GAChB,MAAMC,EAAQD,EAAKE,IAAIC,YAAcH,EAAKE,IAAIE,aACxCC,EAAQL,EAAKM,IAAIH,YAAcH,EAAKM,IAAIF,aAC9CJ,EAAKO,KAAQN,EAAQI,EAErB,MAAMG,EAAKC,iBAAiBT,EAAKM,KACjCN,EAAKU,OAAqC,EAA5BC,SAASH,EAAGI,cAE1B,MAAMC,EAAIb,EAAKM,IAAIQ,MACnBD,EAAEE,SAAY,GACdF,EAAEG,UAAY,GACVhB,EAAKO,MACRM,EAAEI,MAAU,eAAcjB,EAAKU,YAC/BG,EAAEK,OAAS,SAEXL,EAAEI,MAAW,OACbJ,EAAEK,OAAY,eAAclB,EAAKU,YACjCG,EAAEM,SAAW,QAGdnB,EAAKoB,SAAWpB,EAAKO,KAAOP,EAAKE,IAAImB,YAAerB,EAAKE,IAAIoB,aAC7D,MAAMC,EAAUvB,EAAKO,KAAOP,EAAKM,IAAIkB,aAAexB,EAAKM,IAAImB,cAE7DzB,EAAK0B,UAAYH,EAAMvB,EAAKoB,SAC5BpB,EAAK2B,MAAY,EACjBC,EAAkB5B,EAAKE,IAAKF,EAAKM,KAGlC,SAASuB,EAAU7B,GAClB,MAAMM,EAAMN,EAAKM,IACZA,EAAIwB,MACRxB,EAAIQ,MAAMiB,QAAU,IACpBzB,EAAIwB,IAAM9B,EAAK8B,IACfxB,EAAI0B,iBAAiB,QAAQ,KAC5BjC,EAAQC,GACRiC,EAASjC,EAAKE,IAAKF,EAAKkC,KAAKC,aAC7BC,YAAW,KAAQ9B,EAAIQ,MAAMiB,QAAU,MAAQ,OASlD,SAASM,EAAerC,EAAM2B,GAC7B3B,EAAK2B,MAAQW,KAAKC,IAAI,EAAGD,KAAKE,IAAIxC,EAAKkC,KAAKO,YAAad,IAEzD,MAAMe,EAAQ1C,EAAKoB,SAAWpB,EAAK2B,MAAQ3B,EAAKU,OAAU,KACtDV,EAAKO,KACRP,EAAKM,IAAIQ,MAAMC,SAAW2B,EAE1B1C,EAAKM,IAAIQ,MAAME,UAAY0B,EAE5Bd,EAAkB5B,EAAKE,IAAKF,EAAKM,KAGlC,SAASsB,EAAkB1B,EAAKI,GAC/B,MAAMqC,EAAOrC,EAAIH,YAAayC,EAAOtC,EAAIF,aACnCyC,EAAO3C,EAAImB,YAAayB,EAAO5C,EAAIoB,aACnCT,EAAIP,EAAIQ,MACdD,EAAEkC,KAAQJ,EAAOE,GAAWA,EAAOF,GAAQ,EAAK,KAAQ,EACxD9B,EAAEmC,IAAQJ,EAAOE,GAAWA,EAAOF,GAAQ,EAAK,KAAQ,EA2GzD3D,EAAGgE,YAzPH,SAA+BC,EAAIhB,EAAO,IACzC,GAAkB,IAAdgB,EAAGxD,OAAc,OAErBwC,EAAOiB,OAAOC,OAAO,CACpBC,YAAoB,kBACpBC,mBAAoB,0BAClBpB,GAEH,MAAMqB,EAAKL,EAAGM,KAAIC,IACjB,MAAMC,EAAOC,EAASF,EAAEG,OACjBC,EAAWC,GAapB,SAA0B5B,EAAMJ,GAO/B,MAAM9B,EAAO,CACZkC,KAPDA,EAAOiB,OAAOC,OAAO,CACpBW,gBAAiB,gBACjB5B,YAAiB,YACjBM,YAAiB,IACfP,GAGIJ,IAAAA,EAENH,MAAW,EACXD,UAAW,EACXN,SAAW,KACXb,MAAW,EACXG,OAAW,EAEXR,IAAK,KACLI,IAAK,MAgBN,OAbAN,EAAKE,IAAM8D,SAASC,cAAc,OAClChC,EAASjC,EAAKE,IAAKF,EAAKkC,KAAK6B,iBAE7B/D,EAAKM,IAAM0D,SAASC,cAAc,OAClCjE,EAAKM,IAAI0B,iBAAiB,SAASlC,GAAKA,EAAEoE,oBAC1ClE,EAAKE,IAAIiE,YAAYnE,EAAKM,KAiG3B,SAA6BN,EAAME,GAClC,IAAIkE,EAAK,EAAGC,EAAK,EACbC,GAAW,EAmCf,SAASC,EAAazE,EAAG6B,GACxB7B,EAAEoE,kBACFpE,EAAE0E,iBAEF,MAAOC,EAAIC,GAAM7E,EAAeC,GAC1B6E,GAAMF,EAAKvE,EAAI0E,YAAc5E,EAAK2B,MAClCkD,GAAMH,EAAKxE,EAAI4E,WAAc9E,EAAK2B,MAExCU,EAAerC,EAAM2B,GAErBzB,EAAI0E,WAAaD,EAAK3E,EAAK2B,MAAQ8C,EACnCvE,EAAI4E,UAAaD,EAAK7E,EAAK2B,MAAQ+C,EA5CpCxE,EAAI8B,iBAAiB,aAAalC,IAC7BA,EAAEiF,SACNjF,EAAE0E,kBACDJ,EAAIC,GAAMxE,EAAeC,GAC1BwE,GAAW,MAEZpE,EAAI8B,iBAAiB,aAAalC,IACjC,IAAKwE,EAAU,OACfxE,EAAEoE,kBACFpE,EAAE0E,iBAEF,MAAOC,EAAIC,GAAM7E,EAAeC,GAChCI,EAAI0E,YAAcR,EAAKK,EACvBvE,EAAI4E,WAAcT,EAAKK,EACvBN,EAAKK,EACLJ,EAAKK,KAENxE,EAAI8B,iBAAiB,aAAalC,IAC5BwE,IACLxE,EAAEoE,kBACFpE,EAAE0E,qBAEHtE,EAAI8B,iBAAiB,WAAW,KAAQsC,GAAW,KAEnDpE,EAAI8B,iBAAiB,SAASlC,IAC7B,MAAMe,EAAI,EAAIf,EAAEkF,OAAS,IAAM,GAC/BT,EAAazE,EAAGE,EAAK2B,MAAQd,MAC3B,GACHX,EAAI8B,iBAAiB,YAAYlC,IAC5BE,EAAK0B,UAAY,GACrB6C,EAAazE,EAAGE,EAAK2B,MAAQ3B,EAAK0B,UAAY1B,EAAK0B,UAAY,MAC7D,GAlIHuD,CAAoBjF,EAAMA,EAAKE,KAmJhC,SAA6BF,EAAME,GAClC,IAAIyE,EAAK,EAAGE,EAAK,EACbK,EAAiB,EACjBC,EAAW,EAmCf,SAASC,EAAuB5F,EAAGC,GAClC,MAAM4F,EAAMnF,EAAI0E,WACVU,EAAMpF,EAAI4E,UAGhB,MAAO,EAFKtF,EAAI6F,GAAOrF,EAAK2B,OAChBlC,EAAI6F,GAAOtF,EAAK2B,OAI7B,SAAS4D,EAAYpG,GACpB+F,EAAiB/F,EAAGO,QACnBiF,EAAIE,GAAMO,KAA0BlG,EAAcC,KA9QrD,SAAgCqG,GAC/B,IAAIC,GAAa,EACjBzG,OAAOgD,iBAAiB,aAAclC,IAChC2F,IACL3F,EAAE0E,iBACF1E,EAAE4F,8BACA,CAAEC,SAAS,IACdH,EAAExD,iBAAiB,cAAc,KAAQyD,GAAa,KACtDD,EAAExD,iBAAiB,YAAY,KAAQyD,GAAa,MA2NpDG,CAAuB1F,GAEvBA,EAAI8B,iBAAiB,cAAclC,IAClCqF,EAAW,EACXI,EAAYzF,EAAE+F,YAEf3F,EAAI8B,iBAAiB,aAAalC,IACjCA,EAAE0E,iBACF1E,EAAEoE,kBAEF,MAAM/E,EAAKW,EAAE+F,QACTX,IAAmB/F,EAAGO,QACzB6F,EAAYpG,GAEb,MAAOsF,EAAIC,GAAMxF,EAAcC,GAE/B,GAAI,GAAKA,EAAGO,OAAQ,CACnB,MAAMoG,EA1PT,SAAuB3G,GACtB,MAAM4G,EAAK5G,EAAG,GAAG6G,QAASC,EAAK9G,EAAG,GAAG+G,QAC/BC,EAAKhH,EAAG,GAAG6G,QAASI,EAAKjH,EAAG,GAAG+G,QACrC,OAAO5D,KAAK+D,KAAK/D,KAAKgE,IAAIH,EAAKJ,EAAI,GAAKzD,KAAKgE,IAAIF,EAAKH,EAAI,IAuP3CM,CAAcpH,GAC3B,GAAIgG,EAAU,CACb,MAAMtE,EAAIiF,GAAQX,EAAWnF,EAAK2B,OAC9Bd,GAAKA,IAAM2F,EAAAA,GACdnE,EAAerC,EAAMA,EAAK2B,MAAQd,GAEnCX,EAAI0E,WAAaD,EAAK3E,EAAK2B,MAAQ8C,EACnCvE,EAAI4E,UAAaD,EAAK7E,EAAK2B,MAAQ+C,EAEpCS,EAAWW,EAAO9F,EAAK2B,WAEvBzB,EAAI0E,WAAaD,EAAK3E,EAAK2B,MAAQ8C,EACnCvE,EAAI4E,UAAaD,EAAK7E,EAAK2B,MAAQ+C,IAElC,CAAEiB,SAAS,IAtLdc,CAAoBzG,EAAMA,EAAKE,KAE/BF,EAAI,SAAe,IAAMD,EAAQC,GACjCA,EAAI,OAAe,IAAM6B,EAAU7B,GACnCA,EAAI,QAAe,OACZ,CAACA,EAAMA,EAAKE,KA9CSwG,CAAiBxE,EAAMuB,EAAEG,MAC9C+C,EAgDR,SAA6BlD,GAC5B,GAA6B,WAAzBA,EAAEmD,WAAWC,QAAsB,CACtC,MAAMC,EAAMrD,EAAEmD,WAAWG,qBAAqB,cAC9C,GAAI,EAAID,EAAIpH,OACX,OAAOoH,EAAI,GAAGE,UAGhB,OAAO,KAvDUC,CAAoBxD,GAGpC,OAuDF,SAAgCA,EAAGJ,EAAaC,GAC/CrB,EAASwB,EAAGJ,GACiB,WAAzBI,EAAEmD,WAAWC,SAChB5E,EAASwB,EAAEmD,WAAYtD,GA5DvB4D,CAAuBzD,EAAGvB,EAAI,YAAiBA,EAAI,oBAE5C,CAAEiF,OAAQ1D,EAAGC,KAAAA,EAAMG,UAAAA,EAAWC,MAAAA,EAAO6C,QAAAA,MAE7CS,EAAW7D,EAAIrB,IA4OjB,CAkFC,SAASL,EAAU7B,GAClB,MAAMqH,EAAMrH,EAAKqH,IACbA,EAAIC,aAAa,kBACpBD,EAAIE,gBAAgB,gBACpBF,EAAIvG,MAAMiB,QAAU,IACpBsF,EAAIrF,iBAAiB,QAAQ,KAC5BC,EAASjC,EAAKE,IAAKF,EAAKkC,KAAKC,aAC7BC,YAAW,KAAQiF,EAAIvG,MAAMiB,QAAU,MAAQ,MAEhDsF,EAAIG,gBAAgBC,SAASC,QAAQ1H,EAAK8B,MAwC5C7C,EAAG0I,aAxHH,SAAgCC,EAAIC,EAAM3F,EAAO,IAChD,GAAkB,IAAd0F,EAAGlI,OAAc,OAErBwC,EAAOiB,OAAOC,OAAO,CACpBC,YAAoB,kBACpBC,mBAAoB,0BAClBpB,GAEH,MAAMqB,EAAKqE,EAAGpE,KAAI,CAACsE,EAAGC,KACrB,MAAMrE,EAAOC,EAASkE,EAAKE,GAAGjG,MACvB+B,EAAWC,GAYpB,SAA2B5B,EAAMmF,GAChCnF,EAAOiB,OAAOC,OAAO,CACpB4E,iBAAkB,iBAClB7F,YAAkB,aAChBD,GAEH,MAAMJ,EAkEP,SAAsBA,GACrB,GAAIA,EAAImG,WAAW,2BAA4B,CAC9C,MAAMC,EAAM,IAAIC,IAAIrG,GACdsG,EAAM,IAAIC,gBAAgBH,EAAII,QACpCF,EAAGG,OAAO,cAAe,GACzBL,EAAII,OAASF,EACbtG,EAAMoG,EAAIM,WAEX,OAAO1G,EA1EK2G,CAAapB,EAAIvF,KAI7B,GAFAuF,EAAIE,gBAAgB,OACpBF,EAAIqB,aAAa,eAAgB,KAC5BrB,EAAIvG,MAAM6H,YAAa,CAC3B,MAAOC,EAAGC,GAwEZ,SAA2BrD,GAC1B,IAAIoD,EAAIjI,SAAS6E,EAAEvE,OACf4H,EAAIlI,SAAS6E,EAAEtE,QACnB,GAAI0H,GAAKC,EAAG,MAAO,CAACD,EAAGC,GAEvB,MAAMC,EAAKtD,EAAE1E,MAAMG,MACb8H,EAAKvD,EAAE1E,MAAMI,OACnB,OAAI4H,EAAGE,QAAQ,QAAUF,EAAGpJ,OAAS,GACjCqJ,EAAGC,QAAQ,QAAUD,EAAGrJ,OAAS,EADU,CAAC,EAAG,IAEnDkJ,EAAIjI,SAASmI,GACbD,EAAIlI,SAASoI,GACTH,GAAKC,EAAU,CAACD,EAAGC,GAChB,CAAC,EAAG,IApFKI,CAAkB5B,GAC7BuB,GAAKC,IACRxB,EAAIvG,MAAM6H,YAAe,GAAEC,OAAOC,KAIpC,MAAM7I,EAAO,CACZkC,KAAAA,EAAMJ,IAAAA,EAAKuF,IAAAA,EAEX1F,MAAW,EACXD,UAAW,EACXN,SAAW,KACXb,MAAW,EACXG,OAAW,EAEXR,IAAK,MAYN,OATAF,EAAKE,IAAM8D,SAASC,cAAc,OAClChC,EAASjC,EAAKE,IAAKF,EAAKkC,KAAK8F,kBAE7BhI,EAAKqH,IAAIrF,iBAAiB,SAASlC,GAAKA,EAAEoE,oBAC1ClE,EAAKE,IAAIiE,YAAYnE,EAAKqH,KAE1BrH,EAAI,SAAe,OACnBA,EAAI,OAAe,IAAM6B,EAAU7B,GACnCA,EAAI,QAAe,IAyBpB,SAAeA,GACVA,EAAK8B,IAAImG,WAAW,4BACvBjI,EAAKqH,IAAI6B,cAAcC,YAAY,oDAAqD,KA3BhEC,CAAMpJ,GACxB,CAACA,EAAMA,EAAKE,KAlDSmJ,CAAkBnH,EAAM2F,EAAKE,IAGxD,OAkDF,SAAiCD,EAAGzE,GACnCpB,EAAS6F,EAAGzE,GArDXiG,CAAwBxB,EAAG5F,EAAI,aAExB,CAAEiF,OAAQW,EAAGpE,KAAAA,EAAMG,UAAAA,EAAWC,MAAAA,EAAO6C,QAAS,SAEtDS,EAAW7D,EAAIrB,IAsHjB,SAASkF,EAAW7D,EAAIrB,EAAO,IAC9B,GAAkB,IAAdqB,EAAG7D,OAAc,OAErBwC,EAAOiB,OAAOC,OAAO,CACpBmG,UAAc,YACdC,YAAc,kBACdC,UAAc,gBACdC,UAAc,gBACdC,aAAc,mBAEdC,UAAgB,UAChBC,aAAgB,aAChBC,eAAgB,eAEhBC,WAAY,WACV7H,GAEH,MAAM8H,EAAKzG,EAAGC,KAAIgC,IACjB,MAAMxF,EAuDR,SAAsBkC,EAAMwB,EAAMG,EAAWC,EAAO6C,EAAU,MAC7D,MAAM3G,EAAO,GACbA,EAAKkC,KAAOA,EACZlC,EAAKiK,GAAOpG,EACZ7D,EAAKkK,GAAOC,IACZnK,EAAK0D,KAAOA,EAEZ1D,EAAKoK,IAAMpG,SAASC,cAAc,OAClChC,EAASjC,EAAKoK,IAAKlI,EAAKqH,WACxBvJ,EAAKoK,IAAIpI,iBAAiB,SAASlC,GAyGpC,SAAkBA,GACjBA,EAAE0E,iBACF6F,QAAQC,OA3GgCC,CAASzK,KACjDE,EAAKoK,IAAIjG,YAAYL,GAErB,MAAM0G,EAAMxG,SAASC,cAAc,UAWnC,GAVAhC,EAASuI,EAAKtI,EAAKsH,aACnBxJ,EAAKoK,IAAIjG,YAAYqG,GAErBxK,EAAKyK,QAAUzG,SAASC,cAAc,UACtCjE,EAAK0K,QAAU1G,SAASC,cAAc,UACtChC,EAASjC,EAAKyK,QAASvI,EAAKuH,WAC5BxH,EAASjC,EAAK0K,QAASxI,EAAKwH,WAC5B1J,EAAKoK,IAAIjG,YAAYnE,EAAKyK,SAC1BzK,EAAKoK,IAAIjG,YAAYnE,EAAK0K,SAEtB/D,EAAS,CACZ,MAAMgE,EAAS3G,SAASC,cAAc,OACtC0G,EAAO3D,UAAa,SAAQL,WAC5B1E,EAAS0I,EAAQzI,EAAKyH,cACtB3J,EAAKoK,IAAIjG,YAAYwG,GAMtB,OAJA3G,SAAS4G,KAAKzG,YAAYnE,EAAKoK,KAkDhC,SAA8BpK,EAAM6K,GACnC7K,EAAK0K,QAAQ5J,MAAMgK,QAAU,OACzBD,GACH7K,EAAKyK,QAAQzI,iBAAiB,SAASlC,IACtCA,EAAEoE,kBACF6G,EAAQ/K,GAAM,GACdgL,EAAOH,GAAM,MAQhB,SAA0B7K,EAAMiL,GAC/BjL,EAAK0K,QAAQ1I,iBAAiB,SAASlC,IACtCA,EAAEoE,kBACF6G,EAAQ/K,GAAM,GACdgL,EAAOC,GAAM,MAEdjL,EAAK0K,QAAQ5J,MAAMgK,QAAU,KAZ5BI,CAAiBL,EAAM7K,IAEvBA,EAAKyK,QAAQ3J,MAAMgK,QAAU,OA1D9BK,CAAqBnL,EAAMoL,GAC3BA,EAAepL,EACRA,EAxFOqL,CAAanJ,EAAMsD,EAAE9B,KAAM8B,EAAE3B,UAAW2B,EAAE1B,MAAO0B,EAAEmB,SAEhE,OADAnB,EAAE2B,OAAOnF,iBAAiB,SAASlC,GA4JrC,SAAiBE,EAAMF,GAItB,GAHAA,EAAE0E,iBACFwG,EAAOhL,GAEHyH,SAAS/D,KAAM,CAClB,MAAM4H,EAAS7D,SAAS7D,KAAK2H,OAAO,EAAG9D,SAAS7D,KAAKoF,QAAQ,MAC7DqB,QAAQmB,aAAa,KAAM,GAAIF,GAEhC,MAAMpD,EAAM,IAAMlI,EAAKkC,KAAK6H,WAAa/J,EAAK0D,KAC9C2G,QAAQoB,UAAU,CAAEC,KAAM,YAAaxB,GAAIlK,EAAKkK,IAAM,KAAMhC,GArKnByD,CAAQ3L,EAAMF,KAC/CE,MAMT,SAA4BgK,IA0Q5B,SAAkB4B,EAAIC,GAAU,GAC3BA,GAASD,IACbE,EAAgBC,KAhBjB,SAAkBH,GACjB,IAAII,EACJ,MAAO,IAAIC,KACND,IACJA,GAAY,EACZE,uBAAsB,KACrBF,GAAY,EACZJ,KAAMK,QASaE,CAASP,KA3Q9BQ,EAAS,KACR,IAAK,MAAMpM,KAAQgK,EAAIhK,EAAKiK,GAAGoC,WAC/BjK,YAAW,KAAQ,IAAK,MAAMpC,KAAQgK,EAAIhK,EAAKiK,GAAGoC,aAAe,QAElErN,OAAOgD,iBAAiB,WAAWlC,IAClC,GAAkB,OAAdwM,IAAuBxM,EAAEyM,SAAWzM,EAAE0M,UAAY1M,EAAE2M,SAAU,CACjE,MAAMC,EAAM1C,EAAGsC,GACD,WAAVxM,EAAE6M,IAAkBD,EAAItC,IAAIwC,QACb,cAAV9M,EAAE6M,IAAqBD,EAAIjC,QAAQmC,QACzB,eAAV9M,EAAE6M,KAAsBD,EAAIhC,QAAQkC,YAd/CC,CAAmB7C,GAmBpB,SAAqBA,EAAID,GACxB/K,OAAOgD,iBAAiB,YAAYlC,IACjB,OAAdwM,GAAoBvB,EAAQf,EAAGsC,IAC/BxM,EAAEgN,OAA6B,cAApBhN,EAAEgN,MAAF,WAAqDC,IAAlBjN,EAAEgN,MAAF,IACjD9B,EAAOhB,EAAGlK,EAAEgN,MAAF,QAGZ9N,OAAOgD,iBAAiB,cAAc,IAAMgL,EAAUhD,EAAID,EAAYtC,SAAS/D,QAC/EsJ,EAAUhD,EAAID,EAAYtC,SAAS/D,MA1BnCuJ,CAAYjD,EAAI9H,EAAI,YA6BrB,SAAS8K,EAAUhD,EAAID,EAAYrG,GAClC,GAAgD,IAA5C+D,SAAS/D,KAAKsF,QAAQ,IAAMe,GAAmB,OACnD,MAAMmD,EAAKxJ,EAAKgE,QAAQ,IAAMqC,EAAY,IAC1C,GAAKmD,EACL,IAAK,IAAInF,EAAI,EAAGA,EAAIiC,EAAGtK,OAAQqI,GAAK,EACnC,GAAIiC,EAAGjC,GAAGrE,OAASwJ,EAAI,CACJ,OAAdZ,GAAsBA,IAAcvE,GAAGgD,EAAQf,EAAGsC,IACpC,OAAdA,GAAsBA,IAAcvE,GAAGiD,EAAOhB,EAAGjC,IACrD,OASH,IAAIoC,EAAgB,EAChBiB,EAAgB,KAChBkB,EAAgB,KA0CpB,SAAStB,EAAOhL,EAAMmN,GAAY,GAIjC,GAHAlL,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK0H,WAC7B5J,EAAKiK,GAAGe,SAEJmC,EAAW,CACdnN,EAAKiK,GAAGoC,WACRpK,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK4H,gBAC7B7H,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK2H,cAC7BzH,YAAW,KAAQH,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK4H,gBAAgB,KAAW,IAE3E,MAAM5B,EAAM,IAAMlI,EAAKkC,KAAK6H,WAAa/J,EAAK0D,KAC9C2G,QAAQmB,aAAa,KAAM,GAAItD,QAE/B9F,YAAW,KACVpC,EAAKiK,GAAGoC,WACRpK,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK2H,gBAC3B,GAEJyC,EAAYtM,EAAKkK,GAGlB,SAASa,EAAQ/K,EAAMmN,GAAY,GAClCnN,EAAKiK,GAAGc,UAEJoC,GACHlL,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK4H,gBAC7B7H,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK2H,cAAc,GAC3CzH,YAAW,KAAQH,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK4H,gBAAgB,KAAW,KAE3E7H,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK2H,cAAc,GAE5CzH,YAAW,KAAQH,EAASjC,EAAKoK,IAAKpK,EAAKkC,KAAK0H,WAAW,KAAW,KACtE0C,EAAY,KAyDb,SAAS3I,EAASyJ,EAAKC,GAAQ,GAC9B,IAAIxE,EAAI,WACR,IAAK,IAAId,EAAI,EAAGA,EAAIqF,EAAI1N,OAAQqI,GAAK,EACpCc,GAAKuE,EAAIE,WAAWvF,GACpBc,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAExD,OAAIwE,GAAe,WAAaxE,IAAM,GAAGL,SAAS,KAAK+C,QAAQ,GACxD1C,IAAM,EAuBd,SAAS5G,EAASsL,EAAKC,EAAKC,GAAU,EAAMC,EAAM,IACjD,MAAMf,EAAMa,EAAIjC,OAAO,GACvB,GAAIiC,EAAIvF,WAAW,KACdwF,EACHF,EAAII,QAAQhB,GAAOe,SAEZH,EAAII,QAAQhB,OAEd,CACN,MAAMiB,EAAI,CAACjB,EAAKe,GAAKG,KAAK,KACtBJ,EACHF,EAAIO,UAAUC,IAAIH,GAElBL,EAAIO,UAAUE,OAAOJ,IA6CxB,MAAM9B,EAAkB,GAOxB9H,SAAShC,iBAAiB,oBAAoB,KAC7ChD,OAAOgD,iBAAiB,UAAU,KACjC,IAAK,MAAMiM,KAAKnC,EAAiBmC,MAC/B,CAAEtI,SAAS,OAjvBhB,CAqvBG3G,OAAM","file":"viewer.min.js","sourcesContent":["/**\n *\n * Viewer\n *\n * @author Takuto Yanagida\n * @version 2021-12-07\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] ?? {};\n\n\n(function (NS) {\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Functions for Touch Support\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction getTouchPoint(ts) {\n\t\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\t\tlet x = 0, y = 0;\n\t\t\tif (ts.length === 1) {\n\t\t\t\tx = ts[0].pageX - pxo;\n\t\t\t\ty = ts[0].pageY - pyo;\n\t\t\t} else if (2 <= ts.length) {\n\t\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t\t}\n\t\t\treturn [x, y];\n\t\t}\n\t\t\n\t\tfunction touchDistance(ts) {\n\t\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t\t}\n\t\t\n\t\tfunction preventWindowTouchMove(f) {\n\t\t\tlet isTouching = false;\n\t\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\t\tif (!isTouching) return;\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}, { passive: false });\n\t\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t\t}\n\t\t\n\t\tfunction getCursorPoint(e) {\n\t\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t\t}\n\t\t\n\t\t/**\n\t\t *\n\t\t * Image Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initializeImageViewer(as, opts = {}) {\n\t\t\tif (as.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = as.map(a => {\n\t\t\t\tconst hash = calcHash(a.href);\n\t\t\t\tconst [frameInst, frame] = createImageFrame(opts, a.href);\n\t\t\t\tconst caption = extractImageCaption(a);\n\t\t\t\tassignImageOpenerStyle(a, opts['styleOpener'], opts['styleOpenerWrapper']);\n\t\t\n\t\t\t\treturn { opener: a, hash, frameInst, frame, caption };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createImageFrame(opts, src) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleImageFrame: ':ncFrameImage',\n\t\t\t\tstyleLoaded    : ':ncLoaded',\n\t\t\t\tmaxZoomRate    : 10,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t\timg: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleImageFrame);\n\t\t\n\t\t\tinst.img = document.createElement('img');\n\t\t\tinst.img.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.img);\n\t\t\n\t\t\t_enableMouseGesture(inst, inst.frm);\n\t\t\t_enableTouchGesture(inst, inst.frm);\n\t\t\n\t\t\tinst['doResize'] = () => setSize(inst);\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => {};\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction extractImageCaption(a) {\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\treturn fcs[0].innerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tfunction assignImageOpenerStyle(a, styleOpener, styleOpenerWrapper) {\n\t\t\tsetClass(a, styleOpener);\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tsetClass(a.parentNode, styleOpenerWrapper);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSize(inst) {\n\t\t\tconst winAs = inst.frm.offsetWidth / inst.frm.offsetHeight;\n\t\t\tconst imgAs = inst.img.offsetWidth / inst.img.offsetHeight;\n\t\t\tinst.isLs = (winAs < imgAs);\n\t\t\n\t\t\tconst cs = getComputedStyle(inst.img);\n\t\t\tinst.margin = parseInt(cs.outlineWidth) * 2;\n\t\t\n\t\t\tconst s = inst.img.style;\n\t\t\ts.minWidth  = '';\n\t\t\ts.minHeight = '';\n\t\t\tif (inst.isLs) {\n\t\t\t\ts.width  = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.height = 'auto';\n\t\t\t} else {\n\t\t\t\ts.width    = 'auto';\n\t\t\t\ts.height   = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.maxWidth = 'none';\n\t\t\t}\n\t\t\n\t\t\tinst.baseSize = inst.isLs ? inst.frm.clientWidth  : inst.frm.clientHeight;\n\t\t\tconst nbs     = inst.isLs ? inst.img.naturalWidth : inst.img.naturalHeight;\n\t\t\n\t\t\tinst.realScale = nbs / inst.baseSize;\n\t\t\tinst.scale     = 1;\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst img = inst.img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = inst.src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tsetSize(inst);\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setScaledSize(inst, scale) {\n\t\t\tinst.scale = Math.max(1, Math.min(inst.opts.maxZoomRate, scale));\n\t\t\n\t\t\tconst size = (inst.baseSize * inst.scale - inst.margin) + 'px';\n\t\t\tif (inst.isLs) {\n\t\t\t\tinst.img.style.minWidth = size;\n\t\t\t} else {\n\t\t\t\tinst.img.style.minHeight = size;\n\t\t\t}\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction _doCenteringImage(frm, img) {\n\t\t\tconst imgW = img.offsetWidth, imgH = img.offsetHeight;\n\t\t\tconst frmW = frm.clientWidth, frmH = frm.clientHeight;\n\t\t\tconst s = img.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\t\t\n\t\tfunction _enableMouseGesture(inst, frm) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\t\t\n\t\t\tfrm.addEventListener('mousedown', e => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousemove', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tfrm.scrollLeft += xS - cx;\n\t\t\t\tfrm.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousedrag', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tfrm.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\n\t\t\tfrm.addEventListener('wheel', e => {\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\tzoomListener(e, inst.scale * s);\n\t\t\t}, true);\n\t\t\tfrm.addEventListener('dblclick', e => {\n\t\t\t\tif (inst.realScale < 1) return;\n\t\t\t\tzoomListener(e, inst.scale < inst.realScale ? inst.realScale : 1);\n\t\t\t}, true);\n\t\t\n\t\t\tfunction zoomListener(e, scale) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst ix = (cx + frm.scrollLeft) / inst.scale;\n\t\t\t\tconst iy = (cy + frm.scrollTop)  / inst.scale;\n\t\t\n\t\t\t\t_setScaledSize(inst, scale);\n\t\t\n\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _enableTouchGesture(inst, frm) {\n\t\t\tlet ix = 0, iy = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\t\t\n\t\t\tpreventWindowTouchMove(frm);  // for Android\n\t\t\n\t\t\tfrm.addEventListener('touchstart', e => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tfrm.addEventListener('touchmove', e => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) {\n\t\t\t\t\tupdatePoint(ts);\n\t\t\t\t}\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * inst.scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t_setScaledSize(inst, inst.scale * s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / inst.scale;\n\t\t\t\t} else {\n\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t\n\t\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\t\tconst fsx = frm.scrollLeft;\n\t\t\t\tconst fsy = frm.scrollTop;\n\t\t\t\tconst ix = (x + fsx) / inst.scale;\n\t\t\t\tconst iy = (y + fsy) / inst.scale;\n\t\t\t\treturn [ix, iy];\n\t\t\t}\n\t\t\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.viewerImage  = initializeImageViewer;\n\t}\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Iframe Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initializeIframeViewer(os, ifms, opts = {}) {\n\t\t\tif (os.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = os.map((o, i) => {\n\t\t\t\tconst hash = calcHash(ifms[i].src);\n\t\t\t\tconst [frameInst, frame] = createIframeFrame(opts, ifms[i]);\n\t\t\t\tassignIframeOpenerStyle(o, opts['styleOpener']);\n\t\t\n\t\t\t\treturn { opener: o, hash, frameInst, frame, caption: null };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createIframeFrame(opts, ifm) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleIframeFrame: ':ncFrameIframe',\n\t\t\t\tstyleLoaded     : ':ncLoaded',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst src = filterSource(ifm.src);\n\t\t\n\t\t\tifm.removeAttribute('src');\n\t\t\tifm.setAttribute('data-nc-lazy', '');\n\t\t\tif (!ifm.style.aspectRatio) {\n\t\t\t\tconst [w, h] = extractIframeSize(ifm);\n\t\t\t\tif (w && h) {\n\t\t\t\t\tifm.style.aspectRatio = `${w} / ${h}`;\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src, ifm,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleIframeFrame);\n\t\t\n\t\t\tinst.ifm.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.ifm);\n\t\t\n\t\t\tinst['doResize'] = () => {};\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => pause(inst);\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction assignIframeOpenerStyle(o, styleOpener) {\n\t\t\tsetClass(o, styleOpener);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst ifm = inst.ifm;\n\t\t\tif (ifm.hasAttribute('data-nc-lazy')) {\n\t\t\t\tifm.removeAttribute('data-nc-lazy');\n\t\t\t\tifm.style.opacity = '0';\n\t\t\t\tifm.addEventListener('load', () => {\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { ifm.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t\tifm.contentDocument.location.replace(inst.src);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction pause(inst) {\n\t\t\tif (inst.src.startsWith('https://www.youtube.com')) {\n\t\t\t\tinst.ifm.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}', '*');\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction filterSource(src) {\n\t\t\tif (src.startsWith('https://www.youtube.com')) {\n\t\t\t\tconst url = new URL(src);\n\t\t\t\tconst ps  = new URLSearchParams(url.search);\n\t\t\t\tps.append('enablejsapi', 1);\n\t\t\t\turl.search = ps;\n\t\t\t\tsrc = url.toString();\n\t\t\t}\n\t\t\treturn src;\n\t\t}\n\t\t\n\t\tfunction extractIframeSize(f) {\n\t\t\tlet w = parseInt(f.width);\n\t\t\tlet h = parseInt(f.height);\n\t\t\tif (w && h) return [w, h];\n\t\t\n\t\t\tconst sW = f.style.width;\n\t\t\tconst sH = f.style.height;\n\t\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\t\tw = parseInt(sW);\n\t\t\th = parseInt(sH);\n\t\t\tif (w && h) return [w, h];\n\t\t\treturn [0, 0];\n\t\t}\n\t\t\n\t\tNS.viewerIframe = initializeIframeViewer;\n\t}\n\n\t/**\n\t *\n\t * Dialog\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-18\n\t *\n\t */\n\t\n\t\n\tfunction initialize(fs, opts = {}) {\n\t\tif (fs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleRoot   : ':ncViewer',\n\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\tstyleCaption: ':ncViewerCaption',\n\t\n\t\t\tstyleOpen     : ':ncOpen',\n\t\t\tstyleVisible  : ':ncVisible',\n\t\t\tstyleInstantly: ':ncInstantly',\n\t\n\t\t\thashPrefix: 'viewer:',\n\t\t}, opts);\n\t\n\t\tconst is = fs.map(f => {\n\t\t\tconst inst = createViewer(opts, f.hash, f.frameInst, f.frame, f.caption);\n\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\treturn inst;\n\t\t});\n\t\tassignEventHandler(is);\n\t\tprocessHash(is, opts['hashPrefix']);\n\t}\n\t\n\tfunction assignEventHandler(is) {\n\t\tonResize(() => {\n\t\t\tfor (const inst of is) inst.fi.doResize();\n\t\t\tsetTimeout(() => { for (const inst of is) inst.fi.doResize(); }, 200);\n\t\t});\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\tconst cur = is[currentId];\n\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction processHash(is, hashPrefix) {\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tif (currentId !== null) doClose(is[currentId]);\n\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\tdoOpen(is[e.state['id']]);\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\tcheckHash(is, hashPrefix, location.hash);\n\t}\n\t\n\tfunction checkHash(is, hashPrefix, hash) {\n\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\tconst ih = hash.replace('#' + hashPrefix, '');\n\t\tif (!ih) return;\n\t\tfor (let i = 0; i < is.length; i += 1) {\n\t\t\tif (is[i].hash === ih) {\n\t\t\t\tif (currentId !== null && currentId !== i) doClose(is[currentId]);\n\t\t\t\tif (currentId === null || currentId !== i) doOpen(is[i]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet instanceCount = 0;\n\tlet prevInstance  = null;\n\tlet currentId     = null;\n\t\n\tfunction createViewer(opts, hash, frameInst, frame, caption = null) {\n\t\tconst inst = {};\n\t\tinst.opts = opts;\n\t\tinst.fi   = frameInst;\n\t\tinst.id   = instanceCount++;\n\t\tinst.hash = hash;\n\t\n\t\tinst.dlg = document.createElement('div');\n\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\tinst.dlg.appendChild(frame);\n\t\n\t\tconst btn = document.createElement('button');\n\t\tsetClass(btn, opts.styleCloser);\n\t\tinst.dlg.appendChild(btn);\n\t\n\t\tinst.btnPrev = document.createElement('button');\n\t\tinst.btnNext = document.createElement('button');\n\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\tinst.dlg.appendChild(inst.btnNext);\n\t\n\t\tif (caption) {\n\t\t\tconst divCap = document.createElement('div');\n\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\tinst.dlg.appendChild(divCap);\n\t\t}\n\t\tdocument.body.appendChild(inst.dlg);\n\t\n\t\t_setAdjacentInstance(inst, prevInstance);\n\t\tprevInstance = inst;\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction doOpen(inst, instantly = false) {\n\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\tinst.fi.doOpen();\n\t\n\t\tif (instantly) {\n\t\t\tinst.fi.doResize();\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\t\thistory.replaceState(null, '', url);\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t}, 0);\n\t\t}\n\t\tcurrentId = inst.id;\n\t}\n\t\n\tfunction doClose(inst, instantly = false) {\n\t\tinst.fi.doClose();\n\t\n\t\tif (instantly) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t} else {\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t}\n\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\tcurrentId = null;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setAdjacentInstance(inst, prev) {\n\t\tinst.btnNext.style.display = 'none';\n\t\tif (prev) {\n\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(prev, true);\n\t\t\t});\n\t\t\t_setNextInstance(prev, inst);\n\t\t} else {\n\t\t\tinst.btnPrev.style.display = 'none';\n\t\t}\n\t}\n\t\n\tfunction _setNextInstance(inst, next) {\n\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tdoClose(inst, true);\n\t\t\tdoOpen(next, true);\n\t\t});\n\t\tinst.btnNext.style.display = null;\n\t}\n\t\n\tfunction _onOpen(inst, e) {\n\t\te.preventDefault();\n\t\tdoOpen(inst);\n\t\n\t\tif (location.hash) {\n\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\thistory.replaceState(null, '', newUrl);\n\t\t}\n\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t}\n\t\n\tfunction _onClose(e) {\n\t\te.preventDefault();\n\t\thistory.back();\n\t}\n\t\n\t/**\n\t *\n\t * Functions for Hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\t\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n})(window['NACSS']);\n"]}