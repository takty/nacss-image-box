{"version":3,"sources":["viewer.js"],"names":["window","NS","calcHash","str","asHex","h","i","length","charCodeAt","hex","toString","substring","cache","Map","calcHashSet","has","n","get","set","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","getTouchPoint","ts","pxo","scrollX","pyo","scrollY","x","y","pageX","pageY","getCursorPoint","e","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","document","addEventListener","l","passive","apply","as","opts","Object","assign","styleOpener","styleOpenerWrapper","fs","map","a","id","href","frameInst","frame","src","styleImageFrame","styleLoaded","maxZoomRate","inst","scale","realScale","baseSize","isLs","margin","frm","img","createElement","stopPropagation","appendChild","xS","yS","isMoving","zoomListener","preventDefault","cx","cy","ix","scrollLeft","iy","scrollTop","_setScaledSize","button","s","deltaY","_enableMouseGesture","lastTouchCount","baseDist","touchPointToImagePoint","fsx","fsy","updatePoint","f","isTouching","stopImmediatePropagation","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","Math","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","setSize","setSource","createImageFrame","caption","parentNode","tagName","fcs","getElementsByTagName","innerHTML","extractImageCaption","assignImageOpenerStyle","opener","initialize","winAs","offsetWidth","offsetHeight","imgAs","cs","getComputedStyle","parseInt","outlineWidth","style","minWidth","minHeight","width","height","maxWidth","clientWidth","clientHeight","nbs","naturalWidth","naturalHeight","_doCenteringImage","opacity","setTimeout","max","min","size","imgW","imgH","frmW","frmH","left","top","applyImage","os","ifms","o","ifm","styleIframeFrame","url","URL","ps","URLSearchParams","search","append","filterSource","removeAttribute","setAttribute","aspectRatio","w","sW","sH","indexOf","extractIframeSize","contentWindow","postMessage","pause","createIframeFrame","assignIframeOpenerStyle","hasAttribute","contentDocument","location","replace","applyIframe","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","hashPrefix","is","prev","createViewer","_onOpen","values","fi","doResize","currentId","altKey","ctrlKey","shiftKey","cur","dlg","click","btnPrev","btnNext","assignEventHandler","doClose","state","undefined","doOpen","checkHash","hash","processHash","prevInstance","history","back","_onClose","btn","divCap","body","display","next","_setNextInstance","_setAdjacentInstance","instantly","replaceState","sty","documentElement","marginTop","newUrl","pushState","name"],"mappings":"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","file":"viewer.min.js","sourcesContent":["/**\n *\n * Viewer\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\nwindow['NACSS']           = window['NACSS']           || {};\nwindow['NACSS']['viewer'] = window['NACSS']['viewer'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Functions for Hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-08-17\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) {\n\t\t\tconst hex = '0000000' + (h >>> 0).toString(16);\n\t\t\treturn hex.substring(hex.length - 8);\n\t\t}\n\t\treturn h >>> 0;\n\t}\n\t\n\tconst cache = new Map();\n\t\n\tfunction calcHashSet(str, asHex = true) {\n\t\tif (cache.has(str)) {\n\t\t\tconst n = cache.get(str);\n\t\t\tcache.set(str, n + 1);\n\t\t\treturn calcHash(str + n, asHex);\n\t\t} else {\n\t\t\tcache.set(str, 1);\n\t\t\treturn calcHash(str, asHex);\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Functions for Touch Support\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-07-18\n\t *\n\t */\n\t\n\t\n\tfunction getTouchPoint(ts) {\n\t\tconst pxo = window.scrollX, pyo = window.scrollY;\n\t\tlet x = 0, y = 0;\n\t\tif (ts.length === 1) {\n\t\t\tx = ts[0].pageX - pxo;\n\t\t\ty = ts[0].pageY - pyo;\n\t\t} else if (2 <= ts.length) {\n\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t}\n\t\treturn [x, y];\n\t}\n\t\n\tfunction touchDistance(ts) {\n\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t}\n\t\n\tfunction preventWindowTouchMove(f) {\n\t\tlet isTouching = false;\n\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\tif (!isTouching) return;\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}, { passive: false });\n\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t}\n\t\n\tfunction getCursorPoint(e) {\n\t\treturn [e.pageX - window.scrollX, e.pageY - window.scrollY];\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t{\n\t\t/**\n\t\t *\n\t\t * Image Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2022-08-17\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction apply(as, opts = {}) {\n\t\t\tif (as.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = as.map(a => {\n\t\t\t\tconst id = calcHashSet(a.href);\n\t\t\t\tconst [frameInst, frame] = createImageFrame(opts, a.href);\n\t\t\t\tconst caption = extractImageCaption(a);\n\t\t\t\tassignImageOpenerStyle(a, opts['styleOpener'], opts['styleOpenerWrapper']);\n\t\t\n\t\t\t\treturn { opener: a, id, frameInst, frame, caption };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createImageFrame(opts, src) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleImageFrame: ':ncFrameImage',\n\t\t\t\tstyleLoaded    : ':ncLoaded',\n\t\t\t\tmaxZoomRate    : 10,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t\timg: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleImageFrame);\n\t\t\n\t\t\tinst.img = document.createElement('img');\n\t\t\tinst.img.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.img);\n\t\t\n\t\t\t_enableMouseGesture(inst, inst.frm);\n\t\t\t_enableTouchGesture(inst, inst.frm);\n\t\t\n\t\t\tinst['doResize'] = () => setSize(inst);\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => {};\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction extractImageCaption(a) {\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\treturn fcs[0].innerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tfunction assignImageOpenerStyle(a, styleOpener, styleOpenerWrapper) {\n\t\t\tsetClass(a, styleOpener);\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tsetClass(a.parentNode, styleOpenerWrapper);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSize(inst) {\n\t\t\tconst winAs = inst.frm.offsetWidth / inst.frm.offsetHeight;\n\t\t\tconst imgAs = inst.img.offsetWidth / inst.img.offsetHeight;\n\t\t\tinst.isLs = (winAs < imgAs);\n\t\t\n\t\t\tconst cs = getComputedStyle(inst.img);\n\t\t\tinst.margin = parseInt(cs.outlineWidth) * 2;\n\t\t\n\t\t\tconst s = inst.img.style;\n\t\t\ts.minWidth  = '';\n\t\t\ts.minHeight = '';\n\t\t\tif (inst.isLs) {\n\t\t\t\ts.width  = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.height = 'auto';\n\t\t\t} else {\n\t\t\t\ts.width    = 'auto';\n\t\t\t\ts.height   = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.maxWidth = 'none';\n\t\t\t}\n\t\t\n\t\t\tinst.baseSize = inst.isLs ? inst.frm.clientWidth  : inst.frm.clientHeight;\n\t\t\tconst nbs     = inst.isLs ? inst.img.naturalWidth : inst.img.naturalHeight;\n\t\t\n\t\t\tinst.realScale = nbs / inst.baseSize;\n\t\t\tinst.scale     = 1;\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst img = inst.img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = inst.src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tsetSize(inst);\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setScaledSize(inst, scale) {\n\t\t\tinst.scale = Math.max(1, Math.min(inst.opts.maxZoomRate, scale));\n\t\t\n\t\t\tconst size = (inst.baseSize * inst.scale - inst.margin) + 'px';\n\t\t\tif (inst.isLs) {\n\t\t\t\tinst.img.style.minWidth = size;\n\t\t\t} else {\n\t\t\t\tinst.img.style.minHeight = size;\n\t\t\t}\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction _doCenteringImage(frm, img) {\n\t\t\tconst imgW = img.offsetWidth, imgH = img.offsetHeight;\n\t\t\tconst frmW = frm.clientWidth, frmH = frm.clientHeight;\n\t\t\tconst s = img.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\t\t\n\t\tfunction _enableMouseGesture(inst, frm) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\t\t\n\t\t\tfrm.addEventListener('mousedown', e => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousemove', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tfrm.scrollLeft += xS - cx;\n\t\t\t\tfrm.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousedrag', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tfrm.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\n\t\t\tfrm.addEventListener('wheel', e => {\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\tzoomListener(e, inst.scale * s);\n\t\t\t}, true);\n\t\t\tfrm.addEventListener('dblclick', e => {\n\t\t\t\tif (inst.realScale < 1) return;\n\t\t\t\tzoomListener(e, inst.scale < inst.realScale ? inst.realScale : 1);\n\t\t\t}, true);\n\t\t\n\t\t\tfunction zoomListener(e, scale) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst ix = (cx + frm.scrollLeft) / inst.scale;\n\t\t\t\tconst iy = (cy + frm.scrollTop)  / inst.scale;\n\t\t\n\t\t\t\t_setScaledSize(inst, scale);\n\t\t\n\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _enableTouchGesture(inst, frm) {\n\t\t\tlet ix = 0, iy = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\t\t\n\t\t\tpreventWindowTouchMove(frm);  // for Android\n\t\t\n\t\t\tfrm.addEventListener('touchstart', e => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tfrm.addEventListener('touchmove', e => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) {\n\t\t\t\t\tupdatePoint(ts);\n\t\t\t\t}\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * inst.scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t_setScaledSize(inst, inst.scale * s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / inst.scale;\n\t\t\t\t} else {\n\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t\n\t\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\t\tconst fsx = frm.scrollLeft;\n\t\t\t\tconst fsy = frm.scrollTop;\n\t\t\t\tconst ix = (x + fsx) / inst.scale;\n\t\t\t\tconst iy = (y + fsy) / inst.scale;\n\t\t\t\treturn [ix, iy];\n\t\t\t}\n\t\t\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyImage = apply;\n\t}\n\t{\n\t\t/**\n\t\t *\n\t\t * Iframe Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2022-08-17\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction apply(os, ifms, opts = {}) {\n\t\t\tif (os.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = os.map((o, i) => {\n\t\t\t\tconst id = calcHashSet(ifms[i].src);\n\t\t\t\tconst [frameInst, frame] = createIframeFrame(opts, ifms[i]);\n\t\t\t\tassignIframeOpenerStyle(o, opts['styleOpener']);\n\t\t\n\t\t\t\treturn { opener: o, id, frameInst, frame, caption: null };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createIframeFrame(opts, ifm) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleIframeFrame: ':ncFrameIframe',\n\t\t\t\tstyleLoaded     : ':ncLoaded',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst src = filterSource(ifm.src);\n\t\t\n\t\t\tifm.removeAttribute('src');\n\t\t\tifm.setAttribute('data-nc-lazy', '');\n\t\t\tif (!ifm.style.aspectRatio) {\n\t\t\t\tconst [w, h] = extractIframeSize(ifm);\n\t\t\t\tif (w && h) {\n\t\t\t\t\tifm.style.aspectRatio = `${w} / ${h}`;\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src, ifm,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleIframeFrame);\n\t\t\n\t\t\tinst.ifm.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.ifm);\n\t\t\n\t\t\tinst['doResize'] = () => {};\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => pause(inst);\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction assignIframeOpenerStyle(o, styleOpener) {\n\t\t\tsetClass(o, styleOpener);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst ifm = inst.ifm;\n\t\t\tif (ifm.hasAttribute('data-nc-lazy')) {\n\t\t\t\tifm.removeAttribute('data-nc-lazy');\n\t\t\t\tifm.style.opacity = '0';\n\t\t\t\tifm.addEventListener('load', () => {\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { ifm.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t\tifm.contentDocument.location.replace(inst.src);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction pause(inst) {\n\t\t\tif (inst.src.startsWith('https://www.youtube.com')) {\n\t\t\t\tinst.ifm.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}', '*');\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction filterSource(src) {\n\t\t\tif (src.startsWith('https://www.youtube.com')) {\n\t\t\t\tconst url = new URL(src);\n\t\t\t\tconst ps  = new URLSearchParams(url.search);\n\t\t\t\tps.append('enablejsapi', 1);\n\t\t\t\turl.search = ps;\n\t\t\t\tsrc = url.toString();\n\t\t\t}\n\t\t\treturn src;\n\t\t}\n\t\t\n\t\tfunction extractIframeSize(f) {\n\t\t\tlet w = parseInt(f.width);\n\t\t\tlet h = parseInt(f.height);\n\t\t\tif (w && h) return [w, h];\n\t\t\n\t\t\tconst sW = f.style.width;\n\t\t\tconst sH = f.style.height;\n\t\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\t\tw = parseInt(sW);\n\t\t\th = parseInt(sH);\n\t\t\tif (w && h) return [w, h];\n\t\t\treturn [0, 0];\n\t\t}\n\t\t\n\t\tNS.applyIframe = apply;\n\t}\n\t/**\n\t *\n\t * Dialog\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-08-17\n\t *\n\t */\n\t\n\t\n\tfunction initialize(fs, opts = {}) {\n\t\tif (fs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleRoot   : ':ncViewer',\n\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\tstyleCaption: ':ncViewerCaption',\n\t\n\t\t\tstyleOpen     : ':ncOpen',\n\t\t\tstyleVisible  : ':ncVisible',\n\t\t\tstyleInstantly: ':ncInstantly',\n\t\n\t\t\thashPrefix: 'viewer:',\n\t\t}, opts);\n\t\n\t\tconst is = new Map();\n\t\tlet prev = null;\n\t\tfor (const f of fs) {\n\t\t\tconst inst = createViewer(opts, f.id, f.frameInst, f.frame, f.caption, prev);\n\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\tis.set(f.id, inst);\n\t\t\tprev = inst;\n\t\t}\n\t\tassignEventHandler(is);\n\t\tprocessHash(is, opts['hashPrefix']);\n\t}\n\t\n\tfunction assignEventHandler(is) {\n\t\tonResize(() => {\n\t\t\tfor (const inst of is.values()) inst.fi.doResize();\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (const inst of is.values()) inst.fi.doResize();\n\t\t\t}, 200);\n\t\t});\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\tconst cur = is.get(currentId);\n\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction processHash(is, hashPrefix) {\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tif (currentId !== null && is.has(currentId)) {\n\t\t\t\tdoClose(is.get(currentId));\n\t\t\t}\n\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined && is.has(e.state['id'])) {\n\t\t\t\tdoOpen(is.get(e.state['id']));\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\tcheckHash(is, hashPrefix, location.hash);\n\t}\n\t\n\tfunction checkHash(is, hashPrefix, hash) {\n\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\tconst h = hash.replace('#' + hashPrefix, '');\n\t\tif (!h) return;\n\t\tfor (const [id, inst] of is) {\n\t\t\tif (id === h) {\n\t\t\t\tif (currentId !== null && currentId !== id) doClose(is.get(currentId));\n\t\t\t\tif (currentId === null || currentId !== id) doOpen(inst);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet currentId = null;\n\t\n\tfunction createViewer(opts, id, frameInst, frame, caption, prevInstance = null) {\n\t\tconst inst = {};\n\t\tinst.opts = opts;\n\t\tinst.fi   = frameInst;\n\t\tinst.id   = id;\n\t\n\t\tinst.dlg = document.createElement('div');\n\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\tinst.dlg.appendChild(frame);\n\t\n\t\tconst btn = document.createElement('button');\n\t\tsetClass(btn, opts.styleCloser);\n\t\tinst.dlg.appendChild(btn);\n\t\n\t\tinst.btnPrev = document.createElement('button');\n\t\tinst.btnNext = document.createElement('button');\n\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\tinst.dlg.appendChild(inst.btnNext);\n\t\n\t\tif (caption) {\n\t\t\tconst divCap = document.createElement('div');\n\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\tinst.dlg.appendChild(divCap);\n\t\t}\n\t\tdocument.body.appendChild(inst.dlg);\n\t\n\t\t_setAdjacentInstance(inst, prevInstance);\n\t\tprevInstance = inst;\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction doOpen(inst, instantly = false) {\n\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\tinst.fi.doOpen();\n\t\n\t\tif (instantly) {\n\t\t\tinst.fi.doResize();\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.id;\n\t\t\thistory.replaceState(null, '', url);\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t}, 0);\n\t\t}\n\t\tcurrentId = inst.id;\n\t\n\t\tconst sty = getComputedStyle(document.documentElement);\n\t\tif (sty.marginTop) {\n\t\t\tinst.dlg.style.top = sty.marginTop;\n\t\t}\n\t}\n\t\n\tfunction doClose(inst, instantly = false) {\n\t\tinst.fi.doClose();\n\t\n\t\tif (instantly) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t} else {\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t}\n\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\tcurrentId = null;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setAdjacentInstance(inst, prev) {\n\t\tinst.btnNext.style.display = 'none';\n\t\tif (prev) {\n\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(prev, true);\n\t\t\t});\n\t\t\t_setNextInstance(prev, inst);\n\t\t} else {\n\t\t\tinst.btnPrev.style.display = 'none';\n\t\t}\n\t}\n\t\n\tfunction _setNextInstance(inst, next) {\n\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tdoClose(inst, true);\n\t\t\tdoOpen(next, true);\n\t\t});\n\t\tinst.btnNext.style.display = null;\n\t}\n\t\n\tfunction _onOpen(inst, e) {\n\t\te.preventDefault();\n\t\tdoOpen(inst);\n\t\n\t\tif (location.hash) {\n\t\t\tconst newUrl = location.href.substring(0, location.href.indexOf('#'));\n\t\t\thistory.replaceState(null, '', newUrl);\n\t\t}\n\t\tconst url = '#' + inst.opts.hashPrefix + inst.id;\n\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t}\n\t\n\tfunction _onClose(e) {\n\t\te.preventDefault();\n\t\thistory.back();\n\t}\n\t\n\n})(window['NACSS']['viewer']);\n"]}