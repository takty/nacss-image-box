{"version":3,"sources":["viewer.js"],"names":["window","NS","getTouchPoint","ts","pxo","pageXOffset","pyo","pageYOffset","x","y","length","pageX","pageY","getCursorPoint","e","enableClass","enabled","tar","cls","key","substr","startsWith","dataset","classList","add","remove","checkHash","cm","hash","objs","location","indexOf","hashPrefix","ih","replace","i","_hash","curId","doClose","doOpen","prevInstance","instanceCount","createViewer","a","inst","_id","_cm","_src","href","str","asHex","h","charCodeAt","toString","calcHash","addEventListener","preventDefault","newUrl","history","replaceState","url","pushState","name","id","_onOpen","styleOpener","_frm","document","createElement","styleRoot","back","_onClose","_img","stopPropagation","appendChild","btn","styleCloser","_btnPrev","_btnNext","stylePrev","styleNext","parentNode","tagName","fcs","getElementsByTagName","cap","innerHTML","styleCaption","styleOpenerWrapper","body","frame","xS","yS","isMoving","zoomListener","scale","cx","cy","ix","scrollLeft","_scale","iy","scrollTop","_setScaledSize","button","s","deltaY","_realScale","_enableMouseGesture","lastTouchCount","baseDist","touchPointToImagePoint","fsx","fsy","updatePoint","f","isTouching","stopImmediatePropagation","passive","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","Math","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","prev","style","display","next","_setNextInstance","_setAdjacentInstance","setInitialSize","winAs","offsetWidth","offsetHeight","imgAs","_isLandscape","getComputedStyle","_margin","parseInt","outlineWidth","minWidth","minHeight","width","height","maxWidth","setSize","_baseSize","clientWidth","clientHeight","rs","naturalWidth","naturalHeight","_doCenteringImage","instantly","styleOpen","img","src","opacity","styleLoaded","setTimeout","styleInstantly","styleVisible","max","min","maxZoomRate","size","image","imgW","imgH","frmW","frmH","left","top","viewer","as","opts","Object","assign","push","fn","doFirst","resizeListeners","isRunning","args","requestAnimationFrame","throttle","onResize","obj","cur","noMod","altKey","ctrlKey","shiftKey","click","state","undefined","l"],"mappings":"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","file":"viewer.min.js","sourcesContent":["/**\n *\n * Viewer (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-18\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] ?? {};\n\n\n(function (NS) {\n\n\t(function () {\n\t\t/**\n\t\t *\n\t\t * Viewer (JS)\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(as = [], opts = {}) {\n\t\t\tif (as.length === 0) return;\n\t\t\tconst cm = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\n\t\t\t\tstyleRoot   : ':ncViewer',\n\t\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\t\tstyleCaption: ':ncViewerCaption',\n\t\t\n\t\t\t\tstyleOpen     : ':ncOpen',\n\t\t\t\tstyleVisible  : ':ncVisible',\n\t\t\t\tstyleInstantly: ':ncInstantly',\n\t\t\t\tstyleLoaded   : ':ncLoaded',\n\t\t\n\t\t\t\tmaxZoomRate: 10,\n\t\t\t\thashPrefix : 'viewer:',\n\t\t\n\t\t\t\tcurId: null,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst objs = [];\n\t\t\tfor (const a of as) objs.push(createViewer(cm, a));\n\t\t\n\t\t\tonResize(() => {\n\t\t\t\tfor (const obj of objs) setInitialSize(obj);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tfor (const obj of objs) setInitialSize(obj);\n\t\t\t\t}, 200);\n\t\t\t});\n\t\t\twindow.addEventListener('keydown', e => {\n\t\t\t\tif (cm.curId === null) return;\n\t\t\t\tconst cur   = objs[cm.curId];\n\t\t\t\tconst noMod = !e.altKey && !e.ctrlKey && !e.shiftKey;\n\t\t\t\tif (e.key === 'Escape' && noMod) cur._frm.click();\n\t\t\t\telse if (e.key === 'ArrowLeft' && noMod) cur._btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight' && noMod) cur._btnNext.click();\n\t\t\t});\n\t\t\n\t\t\twindow.addEventListener('popstate', e => {\n\t\t\t\tif (cm.curId !== null) doClose(objs[cm.curId]);\n\t\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\t\tdoOpen(objs[e.state['id']]);\n\t\t\t\t}\n\t\t\t});\n\t\t\twindow.addEventListener('hashchange', () => checkHash(cm, location.hash, objs));\n\t\t\tcheckHash(cm, location.hash, objs);\n\t\t}\n\t\t\n\t\tfunction checkHash(cm, hash, objs) {\n\t\t\tif (location.hash.indexOf('#' + cm.hashPrefix) !== 0) return;\n\t\t\tconst ih = hash.replace('#' + cm.hashPrefix, '');\n\t\t\tif (!ih) return;\n\t\t\tfor (let i = 0; i < objs.length; i += 1) {\n\t\t\t\tif (objs[i]._hash === ih) {\n\t\t\t\t\tif (cm.curId !== null && cm.curId !== i) doClose(objs[cm.curId]);\n\t\t\t\t\tif (cm.curId === null || cm.curId !== i) doOpen(objs[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tlet prevInstance = null;\n\t\tlet instanceCount = 0;\n\t\t\n\t\t\n\t\tfunction createViewer(cm, a) {\n\t\t\tconst inst = {};\n\t\t\tinst._id = instanceCount;\n\t\t\tinst._cm = cm;\n\t\t\tinst._src = a.href;\n\t\t\tinst._hash = calcHash(inst._src);\n\t\t\n\t\t\ta.addEventListener('click', e => _onOpen(inst, e, inst._hash));\n\t\t\tenableClass(true, a, inst._cm.styleOpener);\n\t\t\n\t\t\tinst._frm = document.createElement('div');\n\t\t\tenableClass(true, inst._frm, inst._cm.styleRoot);\n\t\t\tinst._frm.addEventListener('click', e => _onClose(e));\n\t\t\n\t\t\tinst._img = document.createElement('img');\n\t\t\tinst._img.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst._frm.appendChild(inst._img);\n\t\t\n\t\t\tconst btn = document.createElement('button');\n\t\t\tenableClass(true, btn, inst._cm.styleCloser);\n\t\t\tinst._frm.appendChild(btn);\n\t\t\n\t\t\tinst._btnPrev = document.createElement('button');\n\t\t\tinst._btnNext = document.createElement('button');\n\t\t\tenableClass(true, inst._btnPrev, inst._cm.stylePrev);\n\t\t\tenableClass(true, inst._btnNext, inst._cm.styleNext);\n\t\t\tinst._frm.appendChild(inst._btnPrev);\n\t\t\tinst._frm.appendChild(inst._btnNext);\n\t\t\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\tconst cap = document.createElement('div');\n\t\t\t\t\tcap.innerHTML = '<span>' + fcs[0].innerHTML + '</span>';\n\t\t\t\t\tenableClass(true, cap, inst._cm.styleCaption);\n\t\t\t\t\tinst._frm.appendChild(cap);\n\t\t\t\t}\n\t\t\t\tenableClass(true, a.parentNode, inst._cm.styleOpenerWrapper);\n\t\t\t}\n\t\t\tdocument.body.appendChild(inst._frm);\n\t\t\n\t\t\t_enableMouseGesture(inst, inst._frm);\n\t\t\t_enableTouchGesture(inst, inst._frm);\n\t\t\t_setAdjacentInstance(inst, prevInstance);\n\t\t\n\t\t\tprevInstance = inst;\n\t\t\tinstanceCount += 1;\n\t\t\treturn inst;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setInitialSize(inst) {  // Called also when 'onResize'\n\t\t\tinst._scale = 1;\n\t\t\n\t\t\tconst winAs = inst._frm.offsetWidth / inst._frm.offsetHeight;\n\t\t\tconst imgAs = inst._img.offsetWidth / inst._img.offsetHeight;\n\t\t\tinst._isLandscape = (winAs < imgAs);\n\t\t\n\t\t\tconst s = getComputedStyle(inst._img);\n\t\t\tinst._margin = parseInt(s.outlineWidth) * 2;\n\t\t\n\t\t\tsetSize(inst._img.style);\n\t\t\tfunction setSize(s) {\n\t\t\t\ts.minWidth  = '';\n\t\t\t\ts.minHeight = '';\n\t\t\t\tif (inst._isLandscape) {\n\t\t\t\t\ts.width  = `calc(100% - ${inst._margin}px)`;\n\t\t\t\t\ts.height = 'auto';\n\t\t\t\t} else {\n\t\t\t\t\ts.width    = 'auto';\n\t\t\t\t\ts.height   = `calc(100% - ${inst._margin}px)`;\n\t\t\t\t\ts.maxWidth = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t\tinst._baseSize = inst._isLandscape ? inst._frm.clientWidth : inst._frm.clientHeight;\n\t\t\tconst rs = inst._isLandscape ? inst._img.naturalWidth : inst._img.naturalHeight;\n\t\t\tinst._realScale = rs / inst._baseSize;\n\t\t\t_doCenteringImage(inst._frm, inst._img);\n\t\t}\n\t\t\n\t\tfunction doOpen(inst, instantly = false) {\n\t\t\tenableClass(true, inst._frm, inst._cm.styleOpen);\n\t\t\tconst img = inst._img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = inst._src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tsetInitialSize(inst);\n\t\t\t\t\tenableClass(true, inst._frm, inst._cm.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (instantly) {\n\t\t\t\tsetInitialSize(inst);\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleInstantly);\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleVisible);\n\t\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleInstantly); }, 20);\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsetInitialSize(inst);\n\t\t\t\t\tenableClass(true, inst._frm, inst._cm.styleVisible);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tinst._cm.curId = inst._id;\n\t\t}\n\t\t\n\t\tfunction doClose(inst, instantly = false) {\n\t\t\tif (instantly) {\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleInstantly);\n\t\t\t\tenableClass(false, inst._frm, inst._cm.styleVisible);\n\t\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleInstantly); }, 20);\n\t\t\t} else {\n\t\t\t\tenableClass(false, inst._frm, inst._cm.styleVisible);\n\t\t\t}\n\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleOpen); }, 200);\n\t\t\tinst._cm.curId = null;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setAdjacentInstance(inst, prev) {\n\t\t\tinst._btnNext.style.display = 'none';\n\t\t\tif (prev) {\n\t\t\t\tinst._btnPrev.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdoClose(inst, true);\n\t\t\t\t\tdoOpen(prev, true);\n\t\t\t\t});\n\t\t\t\t_setNextInstance(prev, inst);\n\t\t\t} else {\n\t\t\t\tinst._btnPrev.style.display = 'none';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _setNextInstance(inst, next) {\n\t\t\tinst._btnNext.addEventListener('click', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(next, true);\n\t\t\t});\n\t\t\tinst._btnNext.style.display = null;\n\t\t}\n\t\t\n\t\tfunction _onOpen(inst, e, hash) {\n\t\t\te.preventDefault();\n\t\t\tdoOpen(inst);\n\t\t\n\t\t\tif (location.hash) {\n\t\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\t\thistory.replaceState(null, '', newUrl);\n\t\t\t}\n\t\t\tconst url = '#' + inst._cm.hashPrefix + hash;\n\t\t\thistory.pushState({ name: 'nc-viewer', id: inst._id }, null, url);\n\t\t}\n\t\t\n\t\tfunction _onClose(e) {\n\t\t\te.preventDefault();\n\t\t\thistory.back();\n\t\t}\n\t\t\n\t\tfunction _setScaledSize(inst, scale) {\n\t\t\tinst._scale = Math.max(1, Math.min(inst._cm.maxZoomRate, scale));\n\t\t\n\t\t\tconst size = (inst._baseSize * inst._scale - inst._margin) + 'px';\n\t\t\tif (inst._isLandscape) {\n\t\t\t\tinst._img.style.minWidth = size;\n\t\t\t} else {\n\t\t\t\tinst._img.style.minHeight = size;\n\t\t\t}\n\t\t\t_doCenteringImage(inst._frm, inst._img);\n\t\t}\n\t\t\n\t\tfunction _doCenteringImage(frame, image) {\n\t\t\tconst imgW = image.offsetWidth, imgH = image.offsetHeight;\n\t\t\tconst frmW = frame.clientWidth, frmH = frame.clientHeight;\n\t\t\tconst s = image.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\t\t\n\t\tfunction _enableMouseGesture(inst, frame) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\t\t\n\t\t\tframe.addEventListener('mousedown', (e) => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tframe.addEventListener('mousemove', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tframe.scrollLeft += xS - cx;\n\t\t\t\tframe.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tframe.addEventListener('mousedrag', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tframe.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\n\t\t\tframe.addEventListener('wheel', (e) => {\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\tzoomListener(e, inst._scale * s);\n\t\t\t}, true);\n\t\t\tframe.addEventListener('dblclick', (e) => {\n\t\t\t\tif (inst._realScale < 1) return;\n\t\t\t\tzoomListener(e, inst._scale < inst._realScale ? inst._realScale : 1);\n\t\t\t}, true);\n\t\t\tfunction zoomListener(e, scale) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst ix = (cx + frame.scrollLeft) / inst._scale;\n\t\t\t\tconst iy = (cy + frame.scrollTop)  / inst._scale;\n\t\t\n\t\t\t\t_setScaledSize(inst, scale);\n\t\t\n\t\t\t\tframe.scrollLeft = ix * inst._scale - cx;\n\t\t\t\tframe.scrollTop  = iy * inst._scale - cy;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _enableTouchGesture(inst, frame) {\n\t\t\tlet ix = 0, iy = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\t\t\n\t\t\tpreventWindowTouchMove(frame);  // for Android\n\t\t\n\t\t\tframe.addEventListener('touchstart', (e) => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tframe.addEventListener('touchmove', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) updatePoint(ts);\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * inst._scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t_setScaledSize(inst, inst._scale * s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tframe.scrollLeft = ix * inst._scale - cx;\n\t\t\t\t\t\tframe.scrollTop  = iy * inst._scale - cy;\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / inst._scale;\n\t\t\t\t} else {\n\t\t\t\t\tframe.scrollLeft = ix * inst._scale - cx;\n\t\t\t\t\tframe.scrollTop  = iy * inst._scale - cy;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t\n\t\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\t\tconst fsx = frame.scrollLeft;\n\t\t\t\tconst fsy = frame.scrollTop;\n\t\t\t\tconst ix = (x + fsx) / inst._scale;\n\t\t\t\tconst iy = (y + fsy) / inst._scale;\n\t\t\t\treturn [ix, iy];\n\t\t\t}\n\t\t\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.viewer = initialize;\n\t})();\n\n\t/**\n\t *\n\t * Functions for hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\t\n\t/**\n\t *\n\t * Functions for touch support\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-18\n\t *\n\t */\n\t\n\t\n\tfunction getTouchPoint(ts) {\n\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\tlet x = 0, y = 0;\n\t\tif (ts.length === 1) {\n\t\t\tx = ts[0].pageX - pxo;\n\t\t\ty = ts[0].pageY - pyo;\n\t\t} else if (2 <= ts.length) {\n\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t}\n\t\treturn [x, y];\n\t}\n\t\n\tfunction touchDistance(ts) {\n\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t}\n\t\n\tfunction preventWindowTouchMove(f) {\n\t\tlet isTouching = false;\n\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\tif (!isTouching) return;\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}, { passive: false });\n\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t}\n\t\n\tfunction getCursorPoint(e) {\n\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-25\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = '';\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\tfunction getScrollOffset() {\n\t\tconst s = getComputedStyle(document.getElementsByTagName('html')[0]);\n\t\treturn parseInt(s.scrollPaddingTop);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n})(window['NACSS']);\n"]}