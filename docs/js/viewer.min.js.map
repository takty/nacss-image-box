{"version":3,"sources":["viewer.js"],"names":["window","NS","initialize","fs","opts","length","Object","assign","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","hashPrefix","is","map","f","inst","hash","frameInst","frame","caption","fi","id","instanceCount","dlg","document","createElement","setClass","addEventListener","e","preventDefault","history","back","_onClose","appendChild","btn","btnPrev","btnNext","divCap","innerHTML","body","prev","style","display","stopPropagation","doClose","doOpen","next","_setNextInstance","_setAdjacentInstance","prevInstance","createViewer","opener","location","newUrl","href","substr","indexOf","replaceState","url","pushState","name","_onOpen","fn","doFirst","resizeListeners","push","isRunning","args","requestAnimationFrame","throttle","onResize","doResize","setTimeout","currentId","altKey","ctrlKey","shiftKey","cur","key","click","assignEventHandler","state","undefined","checkHash","processHash","ih","replace","i","getTouchPoint","ts","pxo","pageXOffset","pyo","pageYOffset","x","y","pageX","pageY","getCursorPoint","setSize","winAs","frm","offsetWidth","offsetHeight","imgAs","img","isLs","cs","getComputedStyle","margin","parseInt","outlineWidth","s","minWidth","minHeight","width","height","maxWidth","baseSize","clientWidth","clientHeight","nbs","naturalWidth","naturalHeight","realScale","scale","_doCenteringImage","_setScaledSize","Math","max","min","maxZoomRate","size","imgW","imgH","frmW","frmH","left","top","viewerImage","as","styleOpener","styleOpenerWrapper","a","calcHash","src","styleImageFrame","styleLoaded","xS","yS","isMoving","zoomListener","cx","cy","ix","scrollLeft","iy","scrollTop","button","deltaY","_enableMouseGesture","lastTouchCount","baseDist","touchPointToImagePoint","fsx","fsy","updatePoint","isTouching","stopImmediatePropagation","passive","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","opacity","setSource","createImageFrame","parentNode","tagName","fcs","getElementsByTagName","extractImageCaption","assignImageOpenerStyle","viewerIframe","os","ifms","o","ifm","styleIframeFrame","startsWith","URL","ps","URLSearchParams","search","append","toString","filterSource","removeAttribute","setAttribute","aspectRatio","w","h","sW","sH","extractIframeSize","hasAttribute","contentDocument","contentWindow","postMessage","pause","createIframeFrame","assignIframeOpenerStyle","instantly","str","asHex","charCodeAt","tar","cls","enabled","val","dataset","c","join","classList","add","remove","l"],"mappings":"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","file":"viewer.min.js","sourcesContent":["/**\n *\n * Viewer\n *\n * @author Takuto Yanagida\n * @version 2021-11-19\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] ?? {};\n\n\n(function (NS) {\n\n\t(function () {\n\t\t/**\n\t\t *\n\t\t * Functions for Touch Support\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction getTouchPoint(ts) {\n\t\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\t\tlet x = 0, y = 0;\n\t\t\tif (ts.length === 1) {\n\t\t\t\tx = ts[0].pageX - pxo;\n\t\t\t\ty = ts[0].pageY - pyo;\n\t\t\t} else if (2 <= ts.length) {\n\t\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t\t}\n\t\t\treturn [x, y];\n\t\t}\n\t\t\n\t\tfunction touchDistance(ts) {\n\t\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t\t}\n\t\t\n\t\tfunction preventWindowTouchMove(f) {\n\t\t\tlet isTouching = false;\n\t\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\t\tif (!isTouching) return;\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}, { passive: false });\n\t\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t\t}\n\t\t\n\t\tfunction getCursorPoint(e) {\n\t\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t\t}\n\t\t\n\t\t/**\n\t\t *\n\t\t * Image Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initializeImageViewer(as, opts = {}) {\n\t\t\tif (as.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = as.map(a => {\n\t\t\t\tconst hash = calcHash(a.href);\n\t\t\t\tconst [frameInst, frame] = createImageFrame(opts, a.href);\n\t\t\t\tconst caption = extractImageCaption(a);\n\t\t\t\tassignImageOpenerStyle(a, opts['styleOpener'], opts['styleOpenerWrapper']);\n\t\t\n\t\t\t\treturn { opener: a, hash, frameInst, frame, caption };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createImageFrame(opts, src) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleImageFrame: ':ncFrameImage',\n\t\t\t\tstyleLoaded    : ':ncLoaded',\n\t\t\t\tmaxZoomRate    : 10,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t\timg: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleImageFrame);\n\t\t\n\t\t\tinst.img = document.createElement('img');\n\t\t\tinst.img.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.img);\n\t\t\n\t\t\t_enableMouseGesture(inst, inst.frm);\n\t\t\t_enableTouchGesture(inst, inst.frm);\n\t\t\n\t\t\tinst['doResize'] = () => setSize(inst);\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => {};\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction extractImageCaption(a) {\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\treturn fcs[0].innerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tfunction assignImageOpenerStyle(a, styleOpener, styleOpenerWrapper) {\n\t\t\tsetClass(a, styleOpener);\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tsetClass(a.parentNode, styleOpenerWrapper);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSize(inst) {\n\t\t\tconst winAs = inst.frm.offsetWidth / inst.frm.offsetHeight;\n\t\t\tconst imgAs = inst.img.offsetWidth / inst.img.offsetHeight;\n\t\t\tinst.isLs = (winAs < imgAs);\n\t\t\n\t\t\tconst cs = getComputedStyle(inst.img);\n\t\t\tinst.margin = parseInt(cs.outlineWidth) * 2;\n\t\t\n\t\t\tconst s = inst.img.style;\n\t\t\ts.minWidth  = '';\n\t\t\ts.minHeight = '';\n\t\t\tif (inst.isLs) {\n\t\t\t\ts.width  = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.height = 'auto';\n\t\t\t} else {\n\t\t\t\ts.width    = 'auto';\n\t\t\t\ts.height   = `calc(100% - ${inst.margin}px)`;\n\t\t\t\ts.maxWidth = 'none';\n\t\t\t}\n\t\t\n\t\t\tinst.baseSize = inst.isLs ? inst.frm.clientWidth  : inst.frm.clientHeight;\n\t\t\tconst nbs     = inst.isLs ? inst.img.naturalWidth : inst.img.naturalHeight;\n\t\t\n\t\t\tinst.realScale = nbs / inst.baseSize;\n\t\t\tinst.scale     = 1;\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst img = inst.img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = inst.src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tsetSize(inst);\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setScaledSize(inst, scale) {\n\t\t\tinst.scale = Math.max(1, Math.min(inst.opts.maxZoomRate, scale));\n\t\t\n\t\t\tconst size = (inst.baseSize * inst.scale - inst.margin) + 'px';\n\t\t\tif (inst.isLs) {\n\t\t\t\tinst.img.style.minWidth = size;\n\t\t\t} else {\n\t\t\t\tinst.img.style.minHeight = size;\n\t\t\t}\n\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t}\n\t\t\n\t\tfunction _doCenteringImage(frm, img) {\n\t\t\tconst imgW = img.offsetWidth, imgH = img.offsetHeight;\n\t\t\tconst frmW = frm.clientWidth, frmH = frm.clientHeight;\n\t\t\tconst s = img.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\t\t\n\t\tfunction _enableMouseGesture(inst, frm) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\t\t\n\t\t\tfrm.addEventListener('mousedown', e => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousemove', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tfrm.scrollLeft += xS - cx;\n\t\t\t\tfrm.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tfrm.addEventListener('mousedrag', e => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tfrm.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\n\t\t\tfrm.addEventListener('wheel', e => {\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\tzoomListener(e, inst.scale * s);\n\t\t\t}, true);\n\t\t\tfrm.addEventListener('dblclick', e => {\n\t\t\t\tif (inst.realScale < 1) return;\n\t\t\t\tzoomListener(e, inst.scale < inst.realScale ? inst.realScale : 1);\n\t\t\t}, true);\n\t\t\n\t\t\tfunction zoomListener(e, scale) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst ix = (cx + frm.scrollLeft) / inst.scale;\n\t\t\t\tconst iy = (cy + frm.scrollTop)  / inst.scale;\n\t\t\n\t\t\t\t_setScaledSize(inst, scale);\n\t\t\n\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _enableTouchGesture(inst, frm) {\n\t\t\tlet ix = 0, iy = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\t\t\n\t\t\tpreventWindowTouchMove(frm);  // for Android\n\t\t\n\t\t\tfrm.addEventListener('touchstart', e => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tfrm.addEventListener('touchmove', e => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) {\n\t\t\t\t\tupdatePoint(ts);\n\t\t\t\t}\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * inst.scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t_setScaledSize(inst, inst.scale * s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / inst.scale;\n\t\t\t\t} else {\n\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t\n\t\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\t\tconst fsx = frm.scrollLeft;\n\t\t\t\tconst fsy = frm.scrollTop;\n\t\t\t\tconst ix = (x + fsx) / inst.scale;\n\t\t\t\tconst iy = (y + fsy) / inst.scale;\n\t\t\t\treturn [ix, iy];\n\t\t\t}\n\t\t\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.viewerImage  = initializeImageViewer;\n\t})();\n\n\t(function () {\n\t\t/**\n\t\t *\n\t\t * Iframe Viewer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initializeIframeViewer(os, ifms, opts = {}) {\n\t\t\tif (os.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst fs = os.map((o, i) => {\n\t\t\t\tconst hash = calcHash(ifms[i].src);\n\t\t\t\tconst [frameInst, frame] = createIframeFrame(opts, ifms[i]);\n\t\t\t\tassignIframeOpenerStyle(o, opts['styleOpener']);\n\t\t\n\t\t\t\treturn { opener: o, hash, frameInst, frame, caption: null };\n\t\t\t});\n\t\t\tinitialize(fs, opts);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction createIframeFrame(opts, ifm) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleIframeFrame: ':ncFrameIframe',\n\t\t\t\tstyleLoaded     : ':ncLoaded',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst src = filterSource(ifm.src);\n\t\t\n\t\t\tifm.removeAttribute('src');\n\t\t\tifm.setAttribute('data-nc-lazy', '');\n\t\t\tif (!ifm.style.aspectRatio) {\n\t\t\t\tconst [w, h] = extractIframeSize(ifm);\n\t\t\t\tif (w && h) {\n\t\t\t\t\tifm.style.aspectRatio = `${w} / ${h}`;\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tconst inst = {\n\t\t\t\topts, src, ifm,\n\t\t\n\t\t\t\tscale    : 1,\n\t\t\t\trealScale: 1,\n\t\t\t\tbaseSize : null,\n\t\t\t\tisLs     : false,\n\t\t\t\tmargin   : 0,\n\t\t\n\t\t\t\tfrm: null,\n\t\t\t};\n\t\t\n\t\t\tinst.frm = document.createElement('div');\n\t\t\tsetClass(inst.frm, inst.opts.styleIframeFrame);\n\t\t\n\t\t\tinst.ifm.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst.frm.appendChild(inst.ifm);\n\t\t\n\t\t\tinst['doResize'] = () => {};\n\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\tinst['doClose']  = () => pause(inst);\n\t\t\treturn [inst, inst.frm];\n\t\t}\n\t\t\n\t\tfunction assignIframeOpenerStyle(o, styleOpener) {\n\t\t\tsetClass(o, styleOpener);\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setSource(inst) {\n\t\t\tconst ifm = inst.ifm;\n\t\t\tif (ifm.hasAttribute('data-nc-lazy')) {\n\t\t\t\tifm.removeAttribute('data-nc-lazy');\n\t\t\t\tifm.style.opacity = '0';\n\t\t\t\tifm.addEventListener('load', () => {\n\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { ifm.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t\tifm.contentDocument.location.replace(inst.src);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction pause(inst) {\n\t\t\tif (inst.src.startsWith('https://www.youtube.com')) {\n\t\t\t\tinst.ifm.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}', '*');\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction filterSource(src) {\n\t\t\tif (src.startsWith('https://www.youtube.com')) {\n\t\t\t\tconst url = new URL(src);\n\t\t\t\tconst ps  = new URLSearchParams(url.search);\n\t\t\t\tps.append('enablejsapi', 1);\n\t\t\t\turl.search = ps;\n\t\t\t\tsrc = url.toString();\n\t\t\t}\n\t\t\treturn src;\n\t\t}\n\t\t\n\t\tfunction extractIframeSize(f) {\n\t\t\tlet w = parseInt(f.width);\n\t\t\tlet h = parseInt(f.height);\n\t\t\tif (w && h) return [w, h];\n\t\t\n\t\t\tconst sW = f.style.width;\n\t\t\tconst sH = f.style.height;\n\t\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\t\tw = parseInt(sW);\n\t\t\th = parseInt(sH);\n\t\t\tif (w && h) return [w, h];\n\t\t\treturn [0, 0];\n\t\t}\n\t\t\n\t\tNS.viewerIframe = initializeIframeViewer;\n\t})();\n\n\t/**\n\t *\n\t * Dialog\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-18\n\t *\n\t */\n\t\n\t\n\tfunction initialize(fs, opts = {}) {\n\t\tif (fs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleRoot   : ':ncViewer',\n\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\tstyleCaption: ':ncViewerCaption',\n\t\n\t\t\tstyleOpen     : ':ncOpen',\n\t\t\tstyleVisible  : ':ncVisible',\n\t\t\tstyleInstantly: ':ncInstantly',\n\t\n\t\t\thashPrefix: 'viewer:',\n\t\t}, opts);\n\t\n\t\tconst is = fs.map(f => {\n\t\t\tconst inst = createViewer(opts, f.hash, f.frameInst, f.frame, f.caption);\n\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\treturn inst;\n\t\t});\n\t\tassignEventHandler(is);\n\t\tprocessHash(is, opts['hashPrefix']);\n\t}\n\t\n\tfunction assignEventHandler(is) {\n\t\tonResize(() => {\n\t\t\tfor (const inst of is) inst.fi.doResize();\n\t\t\tsetTimeout(() => { for (const inst of is) inst.fi.doResize(); }, 200);\n\t\t});\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\tconst cur = is[currentId];\n\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction processHash(is, hashPrefix) {\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tif (currentId !== null) doClose(is[currentId]);\n\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\tdoOpen(is[e.state['id']]);\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\tcheckHash(is, hashPrefix, location.hash);\n\t}\n\t\n\tfunction checkHash(is, hashPrefix, hash) {\n\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\tconst ih = hash.replace('#' + hashPrefix, '');\n\t\tif (!ih) return;\n\t\tfor (let i = 0; i < is.length; i += 1) {\n\t\t\tif (is[i].hash === ih) {\n\t\t\t\tif (currentId !== null && currentId !== i) doClose(is[currentId]);\n\t\t\t\tif (currentId === null || currentId !== i) doOpen(is[i]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet instanceCount = 0;\n\tlet prevInstance  = null;\n\tlet currentId     = null;\n\t\n\tfunction createViewer(opts, hash, frameInst, frame, caption = null) {\n\t\tconst inst = {};\n\t\tinst.opts = opts;\n\t\tinst.fi   = frameInst;\n\t\tinst.id   = instanceCount++;\n\t\tinst.hash = hash;\n\t\n\t\tinst.dlg = document.createElement('div');\n\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\tinst.dlg.appendChild(frame);\n\t\n\t\tconst btn = document.createElement('button');\n\t\tsetClass(btn, opts.styleCloser);\n\t\tinst.dlg.appendChild(btn);\n\t\n\t\tinst.btnPrev = document.createElement('button');\n\t\tinst.btnNext = document.createElement('button');\n\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\tinst.dlg.appendChild(inst.btnNext);\n\t\n\t\tif (caption) {\n\t\t\tconst divCap = document.createElement('div');\n\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\tinst.dlg.appendChild(divCap);\n\t\t}\n\t\tdocument.body.appendChild(inst.dlg);\n\t\n\t\t_setAdjacentInstance(inst, prevInstance);\n\t\tprevInstance = inst;\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction doOpen(inst, instantly = false) {\n\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\tinst.fi.doOpen();\n\t\n\t\tif (instantly) {\n\t\t\tinst.fi.doResize();\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\t\thistory.replaceState(null, '', url);\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t}, 0);\n\t\t}\n\t\tcurrentId = inst.id;\n\t}\n\t\n\tfunction doClose(inst, instantly = false) {\n\t\tinst.fi.doClose();\n\t\n\t\tif (instantly) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t} else {\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t}\n\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\tcurrentId = null;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setAdjacentInstance(inst, prev) {\n\t\tinst.btnNext.style.display = 'none';\n\t\tif (prev) {\n\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(prev, true);\n\t\t\t});\n\t\t\t_setNextInstance(prev, inst);\n\t\t} else {\n\t\t\tinst.btnPrev.style.display = 'none';\n\t\t}\n\t}\n\t\n\tfunction _setNextInstance(inst, next) {\n\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tdoClose(inst, true);\n\t\t\tdoOpen(next, true);\n\t\t});\n\t\tinst.btnNext.style.display = null;\n\t}\n\t\n\tfunction _onOpen(inst, e) {\n\t\te.preventDefault();\n\t\tdoOpen(inst);\n\t\n\t\tif (location.hash) {\n\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\thistory.replaceState(null, '', newUrl);\n\t\t}\n\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t}\n\t\n\tfunction _onClose(e) {\n\t\te.preventDefault();\n\t\thistory.back();\n\t}\n\t\n\n\t/**\n\t *\n\t * Functions for Hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\t\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s = getComputedStyle(document.documentElement);\n\t\treturn parseInt(s.scrollPaddingTop);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n})(window['NACSS']);\n"]}