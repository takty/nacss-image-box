{"version":3,"sources":["viewer.js"],"names":["window","NS","getTouchPoint","ts","pxo","pageXOffset","pyo","pageYOffset","x","y","length","pageX","pageY","getCursorPoint","e","enableClass","enabled","tar","cls","key","substr","startsWith","dataset","classList","add","remove","checkHash","cm","hash","objs","location","indexOf","hashPrefix","ih","replace","i","_hash","curId","doClose","doOpen","prevInstance","instanceCount","createViewer","a","inst","_id","_cm","_src","href","str","asHex","h","charCodeAt","toString","calcHash","addEventListener","preventDefault","newUrl","history","replaceState","url","pushState","name","id","_onOpen","styleOpener","_frm","document","createElement","styleRoot","back","_onClose","_img","stopPropagation","appendChild","btn","styleCloser","_btnPrev","_btnNext","stylePrev","styleNext","parentNode","tagName","fcs","getElementsByTagName","cap","innerHTML","styleCaption","styleOpenerWrapper","body","frame","xS","yS","isMoving","button","cx","cy","scrollLeft","scrollTop","imgCx","_scale","imgCy","s","deltaY","_setScaledSize","_enableMouseGesture","lastTouchCount","baseDist","updatePoint","f","isTouching","stopImmediatePropagation","passive","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","Math","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","prev","style","display","next","_setNextInstance","_setAdjacentInstance","setInitialSize","_isPhone","innerWidth","minWindowWidth","winAs","offsetWidth","offsetHeight","imgAs","_isLandscape","size","padding","minWidth","minHeight","width","height","maxWidth","_baseSize","clientWidth","clientHeight","_doCenteringImage","instantly","styleOpen","img","src","opacity","styleLoaded","setTimeout","styleInstantly","styleVisible","scale","max","min","maxZoomRate","image","imgW","imgH","frmW","frmH","left","top","viewer","as","opts","Object","assign","push","fn","doFirst","resizeListeners","isRunning","args","requestAnimationFrame","throttle","onResize","obj","cur","noMod","altKey","ctrlKey","shiftKey","click","state","undefined","l"],"mappings":"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","file":"viewer.min.js","sourcesContent":["/**\n *\n * Viewer (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-18\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] ?? {};\n\n\n(function (NS) {\n\n\t(function () {\n\t\t/**\n\t\t *\n\t\t * Viewer (JS)\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(as = [], opts = {}) {\n\t\t\tif (as.length === 0) return;\n\t\t\tconst cm = Object.assign({\n\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\n\t\t\t\tstyleRoot   : ':ncViewer',\n\t\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\t\tstyleCaption: ':ncViewerCaption',\n\t\t\n\t\t\t\tstyleOpen     : ':ncOpen',\n\t\t\t\tstyleVisible  : ':ncVisible',\n\t\t\t\tstyleInstantly: ':ncInstantly',\n\t\t\t\tstyleLoaded   : ':ncLoaded',\n\t\t\n\t\t\t\tminWindowWidth: 600,\n\t\t\t\tmaxZoomRate   : 5,\n\t\t\t\thashPrefix    : 'viewer:',\n\t\t\t\tpadding       : '6rem',\n\t\t\n\t\t\t\tcurId: null,\n\t\t\t}, opts);\n\t\t\n\t\t\tconst objs = [];\n\t\t\tfor (const a of as) objs.push(createViewer(cm, a));\n\t\t\n\t\t\tonResize(() => {\n\t\t\t\tfor (const obj of objs) setInitialSize(obj);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tfor (const obj of objs) setInitialSize(obj);\n\t\t\t\t}, 200);\n\t\t\t});\n\t\t\twindow.addEventListener('keydown', e => {\n\t\t\t\tif (cm.curId === null) return;\n\t\t\t\tconst cur   = objs[cm.curId];\n\t\t\t\tconst noMod = !e.altKey && !e.ctrlKey && !e.shiftKey;\n\t\t\t\tif (e.key === 'Escape' && noMod) cur._frm.click();\n\t\t\t\telse if (e.key === 'ArrowLeft' && noMod) cur._btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight' && noMod) cur._btnNext.click();\n\t\t\t});\n\t\t\n\t\t\twindow.addEventListener('popstate', e => {\n\t\t\t\tif (cm.curId !== null) doClose(objs[cm.curId]);\n\t\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\t\tdoOpen(objs[e.state['id']]);\n\t\t\t\t}\n\t\t\t});\n\t\t\twindow.addEventListener('hashchange', () => checkHash(cm, location.hash, objs));\n\t\t\tcheckHash(cm, location.hash, objs);\n\t\t}\n\t\t\n\t\tfunction checkHash(cm, hash, objs) {\n\t\t\tif (location.hash.indexOf('#' + cm.hashPrefix) !== 0) return;\n\t\t\tconst ih = hash.replace('#' + cm.hashPrefix, '');\n\t\t\tif (!ih) return;\n\t\t\tfor (let i = 0; i < objs.length; i += 1) {\n\t\t\t\tif (objs[i]._hash === ih) {\n\t\t\t\t\tif (cm.curId !== null && cm.curId !== i) doClose(objs[cm.curId]);\n\t\t\t\t\tif (cm.curId === null || cm.curId !== i) doOpen(objs[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tlet prevInstance = null;\n\t\tlet instanceCount = 0;\n\t\t\n\t\t\n\t\tfunction createViewer(cm, a) {\n\t\t\tconst inst = {};\n\t\t\tinst._id = instanceCount;\n\t\t\tinst._cm = cm;\n\t\t\tinst._src = a.href;\n\t\t\tinst._hash = calcHash(inst._src);\n\t\t\n\t\t\ta.addEventListener('click', e => _onOpen(inst, e, inst._hash));\n\t\t\tenableClass(true, a, inst._cm.styleOpener);\n\t\t\n\t\t\tinst._frm = document.createElement('div');\n\t\t\tenableClass(true, inst._frm, inst._cm.styleRoot);\n\t\t\tinst._frm.addEventListener('click', e => _onClose(e));\n\t\t\n\t\t\tinst._img = document.createElement('img');\n\t\t\tinst._img.addEventListener('click', e => e.stopPropagation());\n\t\t\tinst._frm.appendChild(inst._img);\n\t\t\n\t\t\tconst btn = document.createElement('button');\n\t\t\tenableClass(true, btn, inst._cm.styleCloser);\n\t\t\tinst._frm.appendChild(btn);\n\t\t\n\t\t\tinst._btnPrev = document.createElement('button');\n\t\t\tinst._btnNext = document.createElement('button');\n\t\t\tenableClass(true, inst._btnPrev, inst._cm.stylePrev);\n\t\t\tenableClass(true, inst._btnNext, inst._cm.styleNext);\n\t\t\tinst._frm.appendChild(inst._btnPrev);\n\t\t\tinst._frm.appendChild(inst._btnNext);\n\t\t\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\tconst cap = document.createElement('div');\n\t\t\t\t\tcap.innerHTML = '<span>' + fcs[0].innerHTML + '</span>';\n\t\t\t\t\tenableClass(true, cap, inst._cm.styleCaption);\n\t\t\t\t\tinst._frm.appendChild(cap);\n\t\t\t\t}\n\t\t\t\tenableClass(true, a.parentNode, inst._cm.styleOpenerWrapper);\n\t\t\t}\n\t\t\tdocument.body.appendChild(inst._frm);\n\t\t\n\t\t\t_enableMouseGesture(inst, inst._frm);\n\t\t\t_enableTouchGesture(inst, inst._frm);\n\t\t\t_setAdjacentInstance(inst, prevInstance);\n\t\t\n\t\t\tprevInstance = inst;\n\t\t\tinstanceCount += 1;\n\t\t\n\t\t\treturn inst;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction setInitialSize(inst) {  // Called also when 'onResize'\n\t\t\tinst._isPhone = (window.innerWidth < inst._cm.minWindowWidth);\n\t\t\tinst._scale = 1;\n\t\t\n\t\t\tconst winAs = inst._frm.offsetWidth / inst._frm.offsetHeight;\n\t\t\tconst imgAs = inst._img.offsetWidth / inst._img.offsetHeight;\n\t\t\tinst._isLandscape = (winAs < imgAs);\n\t\t\n\t\t\tconst size = inst._isPhone ? '100%' : 'calc(100% - ' + inst._cm.padding + ')';\n\t\t\tconst s = inst._img.style;\n\t\t\ts.minWidth = '';\n\t\t\ts.minHeight = '';\n\t\t\tif (inst._isLandscape) {\n\t\t\t\ts.width = size;\n\t\t\t\ts.height = 'auto';\n\t\t\t} else {\n\t\t\t\ts.width = 'auto';\n\t\t\t\ts.height = size;\n\t\t\t\ts.maxWidth = 'none';\n\t\t\t}\n\t\t\tinst._baseSize = inst._isLandscape ? inst._frm.clientWidth : inst._frm.clientHeight;\n\t\t\t_doCenteringImage(inst._frm, inst._img);\n\t\t}\n\t\t\n\t\tfunction doOpen(inst, instantly = false) {\n\t\t\tenableClass(true, inst._frm, inst._cm.styleOpen);\n\t\t\tconst img = inst._img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = inst._src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tsetInitialSize(inst);\n\t\t\t\t\tenableClass(true, inst._frm, inst._cm.styleLoaded);\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (instantly) {\n\t\t\t\tsetInitialSize(inst);\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleInstantly);\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleVisible);\n\t\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleInstantly); }, 20);\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsetInitialSize(inst);\n\t\t\t\t\tenableClass(true, inst._frm, inst._cm.styleVisible);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tinst._cm.curId = inst._id;\n\t\t}\n\t\t\n\t\tfunction doClose(inst, instantly = false) {\n\t\t\tif (instantly) {\n\t\t\t\tenableClass(true, inst._frm, inst._cm.styleInstantly);\n\t\t\t\tenableClass(false, inst._frm, inst._cm.styleVisible);\n\t\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleInstantly); }, 20);\n\t\t\t} else {\n\t\t\t\tenableClass(false, inst._frm, inst._cm.styleVisible);\n\t\t\t}\n\t\t\tsetTimeout(() => { enableClass(false, inst._frm, inst._cm.styleOpen); }, 200);\n\t\t\tinst._cm.curId = null;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setAdjacentInstance(inst, prev) {\n\t\t\tinst._btnNext.style.display = 'none';\n\t\t\tif (prev) {\n\t\t\t\tinst._btnPrev.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdoClose(inst, true);\n\t\t\t\t\tdoOpen(prev, true);\n\t\t\t\t});\n\t\t\t\t_setNextInstance(prev, inst);\n\t\t\t} else {\n\t\t\t\tinst._btnPrev.style.display = 'none';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _setNextInstance(inst, next) {\n\t\t\tinst._btnNext.addEventListener('click', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(next, true);\n\t\t\t});\n\t\t\tinst._btnNext.style.display = null;\n\t\t}\n\t\t\n\t\tfunction _onOpen(inst, e, hash) {\n\t\t\te.preventDefault();\n\t\t\tdoOpen(inst);\n\t\t\n\t\t\tif (location.hash) {\n\t\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\t\thistory.replaceState(null, '', newUrl);\n\t\t\t}\n\t\t\tconst url = '#' + inst._cm.hashPrefix + hash;\n\t\t\thistory.pushState({ name: 'nc-viewer', id: inst._id }, null, url);\n\t\t}\n\t\t\n\t\tfunction _onClose(e) {\n\t\t\te.preventDefault();\n\t\t\thistory.back();\n\t\t}\n\t\t\n\t\tfunction _setScaledSize(inst, scale) {\n\t\t\tinst._scale = Math.max(1, Math.min(inst._cm.maxZoomRate, scale));\n\t\t\tlet size = (inst._baseSize * inst._scale) + 'px';\n\t\t\tif (!inst._isPhone) {\n\t\t\t\tsize = `calc(${size} - ${inst._cm.padding})`;\n\t\t\t}\n\t\t\tif (inst._isLandscape) inst._img.style.minWidth = size;\n\t\t\telse inst._img.style.minHeight = size;\n\t\t\t_doCenteringImage(inst._frm, inst._img);\n\t\t}\n\t\t\n\t\tfunction _doCenteringImage(frame, image) {\n\t\t\tconst imgW = image.offsetWidth, imgH = image.offsetHeight;\n\t\t\tconst frmW = frame.clientWidth, frmH = frame.clientHeight;\n\t\t\tconst s = image.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\t\t\n\t\tfunction _enableMouseGesture(inst, frame) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\t\t\n\t\t\tframe.addEventListener('mousedown', (e) => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tframe.addEventListener('mousemove', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tframe.scrollLeft += xS - cx;\n\t\t\t\tframe.scrollTop += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tframe.addEventListener('mousedrag', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tframe.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\n\t\t\tframe.addEventListener('wheel', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst imgCx = (cx + frame.scrollLeft) / inst._scale;\n\t\t\t\tconst imgCy = (cy + frame.scrollTop) / inst._scale;\n\t\t\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\t_setScaledSize(inst, inst._scale * s);\n\t\t\n\t\t\t\tframe.scrollLeft = imgCx * inst._scale - cx;\n\t\t\t\tframe.scrollTop = imgCy * inst._scale - cy;\n\t\t\t}, true);\n\t\t}\n\t\t\n\t\tfunction _enableTouchGesture(inst, frame) {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\t\t\n\t\t\tpreventWindowTouchMove(frame);  // for Android\n\t\t\n\t\t\tframe.addEventListener('touchstart', (e) => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tframe.addEventListener('touchmove', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) updatePoint(ts);\n\t\t\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\t\tframe.scrollLeft += xS - cx;\n\t\t\t\tframe.scrollTop += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst imgCx = (cx + frame.scrollLeft) / inst._scale;\n\t\t\t\t\tconst imgCy = (cy + frame.scrollTop) / inst._scale;\n\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * inst._scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t_setScaledSize(inst, inst._scale * s);\n\t\t\n\t\t\t\t\t\t\tframe.scrollLeft = imgCx * inst._scale - cx;\n\t\t\t\t\t\t\tframe.scrollTop = imgCy * inst._scale - cy;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / inst._scale;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[xS, yS] = getTouchPoint(ts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.viewer = initialize;\n\t})();\n\n\t/**\n\t *\n\t * Functions for hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\t\n\t/**\n\t *\n\t * Functions for touch support\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-18\n\t *\n\t */\n\t\n\t\n\tfunction getTouchPoint(ts) {\n\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\tlet x = 0, y = 0;\n\t\tif (ts.length === 1) {\n\t\t\tx = ts[0].pageX - pxo;\n\t\t\ty = ts[0].pageY - pyo;\n\t\t} else if (2 <= ts.length) {\n\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t}\n\t\treturn [x, y];\n\t}\n\t\n\tfunction touchDistance(ts) {\n\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t}\n\t\n\tfunction preventWindowTouchMove(f) {\n\t\tlet isTouching = false;\n\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\tif (!isTouching) return;\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}, { passive: false });\n\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t}\n\t\n\tfunction getCursorPoint(e) {\n\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-18\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = '';\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n})(window['NACSS']);\n"]}