window.NACSS=window.NACSS??{},function(e){function t(e){const t=window.pageXOffset,n=window.pageYOffset;let s=0,i=0;return 1===e.length?(s=e[0].pageX-t,i=e[0].pageY-n):2<=e.length&&(s=(e[0].pageX+e[1].pageX)/2-t,i=(e[0].pageY+e[1].pageY)/2-n),[s,i]}function n(e){return[e.pageX-window.pageXOffset,e.pageY-window.pageYOffset]}function s(e,t,n=!0,s=""){const i=t.substr(1);if(t.startsWith(":"))n?e.dataset[i]=s:delete e.dataset[i];else{const t=[i,s].join("-");n?e.classList.add(t):e.classList.remove(t)}}!function(){function o(e,t,n){if(0!==location.hash.indexOf("#"+e.hashPrefix))return;const s=t.replace("#"+e.hashPrefix,"");if(s)for(let t=0;t<n.length;t+=1)if(n[t]._hash===s){null!==e.curId&&e.curId!==t&&f(n[e.curId]),null!==e.curId&&e.curId===t||d(n[t]);break}}let c=null,a=0;function r(e,i){const o={};o._id=a,o._cm=e,o._src=i.href,o._hash=function(e,t=!0){let n=2166136261;for(let t=0;t<e.length;t+=1)n^=e.charCodeAt(t),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return t?("0000000"+(n>>>0).toString(16)).substr(-8):n>>>0}(o._src),i.addEventListener("click",(e=>function(e,t,n){if(t.preventDefault(),d(e),location.hash){const e=location.href.substr(0,location.href.indexOf("#"));history.replaceState(null,"",e)}const s="#"+e._cm.hashPrefix+n;history.pushState({name:"nc-viewer",id:e._id},null,s)}(o,e,o._hash))),s(i,o._cm.styleOpener),o._frm=document.createElement("div"),s(o._frm,o._cm.styleRoot),o._frm.addEventListener("click",(e=>function(e){e.preventDefault(),history.back()}(e))),o._img=document.createElement("img"),o._img.addEventListener("click",(e=>e.stopPropagation())),o._frm.appendChild(o._img);const r=document.createElement("button");if(s(r,o._cm.styleCloser),o._frm.appendChild(r),o._btnPrev=document.createElement("button"),o._btnNext=document.createElement("button"),s(o._btnPrev,o._cm.stylePrev),s(o._btnNext,o._cm.styleNext),o._frm.appendChild(o._btnPrev),o._frm.appendChild(o._btnNext),"FIGURE"===i.parentNode.tagName){const e=i.parentNode.getElementsByTagName("figcaption");if(0<e.length){const t=document.createElement("div");t.innerHTML="<span>"+e[0].innerHTML+"</span>",s(t,o._cm.styleCaption),o._frm.appendChild(t)}s(i.parentNode,o._cm.styleOpenerWrapper)}return document.body.appendChild(o._frm),function(e,t){let s=0,i=0,o=!1;function c(s,i){s.stopPropagation(),s.preventDefault();const[o,c]=n(s),a=(o+t.scrollLeft)/e._scale,r=(c+t.scrollTop)/e._scale;_(e,i),t.scrollLeft=a*e._scale-o,t.scrollTop=r*e._scale-c}t.addEventListener("mousedown",(e=>{e.button||(e.preventDefault(),[s,i]=n(e),o=!0)})),t.addEventListener("mousemove",(e=>{if(!o)return;e.stopPropagation(),e.preventDefault();const[c,a]=n(e);t.scrollLeft+=s-c,t.scrollTop+=i-a,s=c,i=a})),t.addEventListener("mousedrag",(e=>{o&&(e.stopPropagation(),e.preventDefault())})),t.addEventListener("mouseup",(()=>{o=!1})),t.addEventListener("wheel",(t=>{const n=0>t.deltaY?1.1:.9;c(t,e._scale*n)}),!0),t.addEventListener("dblclick",(t=>{e._realScale<1||c(t,e._scale<e._realScale?e._realScale:1)}),!0)}(o,o._frm),function(e,n){let s=0,i=0,o=0,c=0;function a(t,s){const i=n.scrollLeft,o=n.scrollTop;return[(t+i)/e._scale,(s+o)/e._scale]}function r(e){o=e.length,[s,i]=a(...t(e))}(function(e){let t=!1;window.addEventListener("touchmove",(e=>{t&&(e.preventDefault(),e.stopImmediatePropagation())}),{passive:!1}),e.addEventListener("touchstart",(()=>{t=!0})),e.addEventListener("touchend",(()=>{t=!1}))})(n),n.addEventListener("touchstart",(e=>{c=0,r(e.touches)})),n.addEventListener("touchmove",(a=>{a.preventDefault(),a.stopPropagation();const l=a.touches;o!==l.length&&r(l);const[d,f]=t(l);if(2<=l.length){const t=function(e){const t=e[0].screenX,n=e[0].screenY,s=e[1].screenX,i=e[1].screenY;return Math.sqrt(Math.pow(s-t,2)+Math.pow(i-n,2))}(l);if(c){const o=t/(c*e._scale);o&&o!==1/0&&_(e,e._scale*o),n.scrollLeft=s*e._scale-d,n.scrollTop=i*e._scale-f}c=t/e._scale}else n.scrollLeft=s*e._scale-d,n.scrollTop=i*e._scale-f}),{passive:!1})}(o,o._frm),function(e,t){e._btnNext.style.display="none",t?(e._btnPrev.addEventListener("click",(n=>{n.stopPropagation(),f(e,!0),d(t,!0)})),function(e,t){e._btnNext.addEventListener("click",(n=>{n.stopPropagation(),f(e,!0),d(t,!0)})),e._btnNext.style.display=null}(t,e)):e._btnPrev.style.display="none"}(o,c),c=o,a+=1,o}function l(e){e._scale=1;const t=e._frm.offsetWidth/e._frm.offsetHeight,n=e._img.offsetWidth/e._img.offsetHeight;e._isLandscape=t<n;const s=getComputedStyle(e._img);e._margin=2*parseInt(s.outlineWidth),function(t){t.minWidth="",t.minHeight="",e._isLandscape?(t.width=`calc(100% - ${e._margin}px)`,t.height="auto"):(t.width="auto",t.height=`calc(100% - ${e._margin}px)`,t.maxWidth="none")}(e._img.style),e._baseSize=e._isLandscape?e._frm.clientWidth:e._frm.clientHeight;const i=e._isLandscape?e._img.naturalWidth:e._img.naturalHeight;e._realScale=i/e._baseSize,m(e._frm,e._img)}function d(e,t=!1){s(e._frm,e._cm.styleOpen);const n=e._img;n.src||(n.style.opacity="0",n.src=e._src,n.addEventListener("load",(()=>{l(e),s(e._frm,e._cm.styleLoaded),setTimeout((()=>{n.style.opacity="1"}),0)}))),t?(l(e),s(e._frm,e._cm.styleInstantly),s(e._frm,e._cm.styleVisible),setTimeout((()=>{s(e._frm,e._cm.styleInstantly,!1)}),20)):setTimeout((()=>{l(e),s(e._frm,e._cm.styleVisible)}),0),e._cm.curId=e._id}function f(e,t=!1){t?(s(e._frm,e._cm.styleInstantly),s(e._frm,e._cm.styleVisible,!1),setTimeout((()=>{s(e._frm,e._cm.styleInstantly,!1)}),20)):s(e._frm,e._cm.styleVisible,!1),setTimeout((()=>{s(e._frm,e._cm.styleOpen,!1)}),200),e._cm.curId=null}function _(e,t){e._scale=Math.max(1,Math.min(e._cm.maxZoomRate,t));const n=e._baseSize*e._scale-e._margin+"px";e._isLandscape?e._img.style.minWidth=n:e._img.style.minHeight=n,m(e._frm,e._img)}function m(e,t){const n=t.offsetWidth,s=t.offsetHeight,i=e.clientWidth,o=e.clientHeight,c=t.style;c.left=n<i?(i-n)/2+"px":0,c.top=s<o?(o-s)/2+"px":0}e.viewer=function(e=[],t={}){if(0===e.length)return;const n=Object.assign({styleOpener:":ncViewerOpener",styleOpenerWrapper:":ncViewerOpenerWrapper",styleRoot:":ncViewer",styleCloser:":ncViewerCloser",stylePrev:":ncViewerPrev",styleNext:":ncViewerNext",styleCaption:":ncViewerCaption",styleOpen:":ncOpen",styleVisible:":ncVisible",styleInstantly:":ncInstantly",styleLoaded:":ncLoaded",maxZoomRate:10,hashPrefix:"viewer:",curId:null},t),s=[];for(const t of e)s.push(r(n,t));!function(e,t=!1){t&&e();i.push(function(e){let t;return(...n)=>{t||(t=!0,requestAnimationFrame((()=>{t=!1,e(...n)})))}}(e))}((()=>{for(const e of s)l(e);setTimeout((()=>{for(const e of s)l(e)}),200)})),window.addEventListener("keydown",(e=>{if(null===n.curId)return;const t=s[n.curId],i=!e.altKey&&!e.ctrlKey&&!e.shiftKey;"Escape"===e.key&&i?t._frm.click():"ArrowLeft"===e.key&&i?t._btnPrev.click():"ArrowRight"===e.key&&i&&t._btnNext.click()})),window.addEventListener("popstate",(e=>{null!==n.curId&&f(s[n.curId]),e.state&&"nc-viewer"===e.state.name&&void 0!==e.state.id&&d(s[e.state.id])})),window.addEventListener("hashchange",(()=>o(n,location.hash,s))),o(n,location.hash,s)}}();const i=[];document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const e of i)e()}),{passive:!0})}))}(window.NACSS);
//# sourceMappingURL=viewer.min.js.map