{"version":3,"sources":["viewer-image.js"],"names":["window","NS","calcHash","str","asHex","h","i","length","charCodeAt","hex","toString","substring","cache","Map","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","getTouchPoint","ts","pxo","pageXOffset","pyo","pageYOffset","x","y","pageX","pageY","getCursorPoint","e","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","setSize","inst","winAs","frm","offsetWidth","offsetHeight","imgAs","img","isLs","cs","getComputedStyle","margin","parseInt","outlineWidth","s","style","minWidth","minHeight","width","height","maxWidth","baseSize","clientWidth","clientHeight","nbs","naturalWidth","naturalHeight","realScale","scale","_doCenteringImage","_setScaledSize","Math","max","min","opts","maxZoomRate","size","imgW","imgH","frmW","frmH","left","top","checkHash","is","hashPrefix","hash","location","indexOf","replace","id","currentId","doClose","get","doOpen","document","addEventListener","l","passive","applyImage","as","Object","assign","styleOpener","styleOpenerWrapper","fs","map","a","has","n","set","calcHashSet","href","frameInst","frame","src","styleImageFrame","styleLoaded","createElement","stopPropagation","appendChild","xS","yS","isMoving","zoomListener","preventDefault","cx","cy","ix","scrollLeft","iy","scrollTop","button","deltaY","_enableMouseGesture","lastTouchCount","baseDist","touchPointToImagePoint","fsx","fsy","updatePoint","f","isTouching","stopImmediatePropagation","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","sqrt","pow","touchDistance","Infinity","_enableTouchGesture","opacity","setTimeout","setSource","createImageFrame","caption","parentNode","tagName","fcs","getElementsByTagName","innerHTML","extractImageCaption","assignImageOpenerStyle","opener","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","prev","createViewer","_onOpen","values","fi","doResize","altKey","ctrlKey","shiftKey","cur","dlg","click","btnPrev","btnNext","assignEventHandler","state","undefined","processHash","initialize","prevInstance","history","back","_onClose","btn","divCap","body","display","next","_setNextInstance","_setAdjacentInstance","instantly","url","replaceState","sty","documentElement","marginTop","newUrl","pushState","name"],"mappings":"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","file":"viewer-image.min.js","sourcesContent":["/**\n *\n * Viewer - Image\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\nwindow['NACSS']           = window['NACSS']           || {};\nwindow['NACSS']['viewer'] = window['NACSS']['viewer'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Functions for Hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-08-17\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) {\n\t\t\tconst hex = '0000000' + (h >>> 0).toString(16);\n\t\t\treturn hex.substring(hex.length - 8);\n\t\t}\n\t\treturn h >>> 0;\n\t}\n\t\n\tconst cache = new Map();\n\t\n\tfunction calcHashSet(str, asHex = true) {\n\t\tif (cache.has(str)) {\n\t\t\tconst n = cache.get(str);\n\t\t\tcache.set(str, n + 1);\n\t\t\treturn calcHash(str + n, asHex);\n\t\t} else {\n\t\t\tcache.set(str, 1);\n\t\t\treturn calcHash(str, asHex);\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Functions for Touch Support\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-18\n\t *\n\t */\n\t\n\t\n\tfunction getTouchPoint(ts) {\n\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\tlet x = 0, y = 0;\n\t\tif (ts.length === 1) {\n\t\t\tx = ts[0].pageX - pxo;\n\t\t\ty = ts[0].pageY - pyo;\n\t\t} else if (2 <= ts.length) {\n\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t}\n\t\treturn [x, y];\n\t}\n\t\n\tfunction touchDistance(ts) {\n\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t}\n\t\n\tfunction preventWindowTouchMove(f) {\n\t\tlet isTouching = false;\n\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\tif (!isTouching) return;\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}, { passive: false });\n\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t}\n\t\n\tfunction getCursorPoint(e) {\n\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n\t/**\n\t *\n\t * Image Viewer\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-08-17\n\t *\n\t */\n\t\n\t\n\tfunction apply(as, opts = {}) {\n\t\tif (as.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t}, opts);\n\t\n\t\tconst fs = as.map(a => {\n\t\t\tconst id = calcHashSet(a.href);\n\t\t\tconst [frameInst, frame] = createImageFrame(opts, a.href);\n\t\t\tconst caption = extractImageCaption(a);\n\t\t\tassignImageOpenerStyle(a, opts['styleOpener'], opts['styleOpenerWrapper']);\n\t\n\t\t\treturn { opener: a, id, frameInst, frame, caption };\n\t\t});\n\t\tinitialize(fs, opts);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction createImageFrame(opts, src) {\n\t\topts = Object.assign({\n\t\t\tstyleImageFrame: ':ncFrameImage',\n\t\t\tstyleLoaded    : ':ncLoaded',\n\t\t\tmaxZoomRate    : 10,\n\t\t}, opts);\n\t\n\t\tconst inst = {\n\t\t\topts, src,\n\t\n\t\t\tscale    : 1,\n\t\t\trealScale: 1,\n\t\t\tbaseSize : null,\n\t\t\tisLs     : false,\n\t\t\tmargin   : 0,\n\t\n\t\t\tfrm: null,\n\t\t\timg: null,\n\t\t};\n\t\n\t\tinst.frm = document.createElement('div');\n\t\tsetClass(inst.frm, inst.opts.styleImageFrame);\n\t\n\t\tinst.img = document.createElement('img');\n\t\tinst.img.addEventListener('click', e => e.stopPropagation());\n\t\tinst.frm.appendChild(inst.img);\n\t\n\t\t_enableMouseGesture(inst, inst.frm);\n\t\t_enableTouchGesture(inst, inst.frm);\n\t\n\t\tinst['doResize'] = () => setSize(inst);\n\t\tinst['doOpen']   = () => setSource(inst);\n\t\tinst['doClose']  = () => {};\n\t\treturn [inst, inst.frm];\n\t}\n\t\n\tfunction extractImageCaption(a) {\n\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\tif (0 < fcs.length) {\n\t\t\t\treturn fcs[0].innerHTML;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tfunction assignImageOpenerStyle(a, styleOpener, styleOpenerWrapper) {\n\t\tsetClass(a, styleOpener);\n\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\tsetClass(a.parentNode, styleOpenerWrapper);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction setSize(inst) {\n\t\tconst winAs = inst.frm.offsetWidth / inst.frm.offsetHeight;\n\t\tconst imgAs = inst.img.offsetWidth / inst.img.offsetHeight;\n\t\tinst.isLs = (winAs < imgAs);\n\t\n\t\tconst cs = getComputedStyle(inst.img);\n\t\tinst.margin = parseInt(cs.outlineWidth) * 2;\n\t\n\t\tconst s = inst.img.style;\n\t\ts.minWidth  = '';\n\t\ts.minHeight = '';\n\t\tif (inst.isLs) {\n\t\t\ts.width  = `calc(100% - ${inst.margin}px)`;\n\t\t\ts.height = 'auto';\n\t\t} else {\n\t\t\ts.width    = 'auto';\n\t\t\ts.height   = `calc(100% - ${inst.margin}px)`;\n\t\t\ts.maxWidth = 'none';\n\t\t}\n\t\n\t\tinst.baseSize = inst.isLs ? inst.frm.clientWidth  : inst.frm.clientHeight;\n\t\tconst nbs     = inst.isLs ? inst.img.naturalWidth : inst.img.naturalHeight;\n\t\n\t\tinst.realScale = nbs / inst.baseSize;\n\t\tinst.scale     = 1;\n\t\t_doCenteringImage(inst.frm, inst.img);\n\t}\n\t\n\tfunction setSource(inst) {\n\t\tconst img = inst.img;\n\t\tif (!img.src) {\n\t\t\timg.style.opacity = '0';\n\t\t\timg.src = inst.src;\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tsetSize(inst);\n\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t});\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setScaledSize(inst, scale) {\n\t\tinst.scale = Math.max(1, Math.min(inst.opts.maxZoomRate, scale));\n\t\n\t\tconst size = (inst.baseSize * inst.scale - inst.margin) + 'px';\n\t\tif (inst.isLs) {\n\t\t\tinst.img.style.minWidth = size;\n\t\t} else {\n\t\t\tinst.img.style.minHeight = size;\n\t\t}\n\t\t_doCenteringImage(inst.frm, inst.img);\n\t}\n\t\n\tfunction _doCenteringImage(frm, img) {\n\t\tconst imgW = img.offsetWidth, imgH = img.offsetHeight;\n\t\tconst frmW = frm.clientWidth, frmH = frm.clientHeight;\n\t\tconst s = img.style;\n\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t}\n\t\n\tfunction _enableMouseGesture(inst, frm) {\n\t\tlet xS = 0, yS = 0;\n\t\tlet isMoving = false;\n\t\n\t\tfrm.addEventListener('mousedown', e => {\n\t\t\tif (e.button) return;  // when button is not left\n\t\t\te.preventDefault();\n\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\tisMoving = true;\n\t\t});\n\t\tfrm.addEventListener('mousemove', e => {\n\t\t\tif (!isMoving) return;\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\n\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\tfrm.scrollLeft += xS - cx;\n\t\t\tfrm.scrollTop  += yS - cy;\n\t\t\txS = cx;\n\t\t\tyS = cy;\n\t\t});\n\t\tfrm.addEventListener('mousedrag', e => {\n\t\t\tif (!isMoving) return;\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});\n\t\tfrm.addEventListener('mouseup', () => { isMoving = false; });\n\t\n\t\tfrm.addEventListener('wheel', e => {\n\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\tzoomListener(e, inst.scale * s);\n\t\t}, true);\n\t\tfrm.addEventListener('dblclick', e => {\n\t\t\tif (inst.realScale < 1) return;\n\t\t\tzoomListener(e, inst.scale < inst.realScale ? inst.realScale : 1);\n\t\t}, true);\n\t\n\t\tfunction zoomListener(e, scale) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\n\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\tconst ix = (cx + frm.scrollLeft) / inst.scale;\n\t\t\tconst iy = (cy + frm.scrollTop)  / inst.scale;\n\t\n\t\t\t_setScaledSize(inst, scale);\n\t\n\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t}\n\t}\n\t\n\tfunction _enableTouchGesture(inst, frm) {\n\t\tlet ix = 0, iy = 0;\n\t\tlet lastTouchCount = 0;\n\t\tlet baseDist = 0;\n\t\n\t\tpreventWindowTouchMove(frm);  // for Android\n\t\n\t\tfrm.addEventListener('touchstart', e => {\n\t\t\tbaseDist = 0;\n\t\t\tupdatePoint(e.touches);\n\t\t});\n\t\tfrm.addEventListener('touchmove', e => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\n\t\t\tconst ts = e.touches;\n\t\t\tif (lastTouchCount !== ts.length) {\n\t\t\t\tupdatePoint(ts);\n\t\t\t}\n\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\n\t\t\tif (2 <= ts.length) {\n\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\tif (baseDist) {\n\t\t\t\t\tconst s = dist / (baseDist * inst.scale);\n\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t_setScaledSize(inst, inst.scale * s);\n\t\t\t\t\t}\n\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t}\n\t\t\t\tbaseDist = dist / inst.scale;\n\t\t\t} else {\n\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t}\n\t\t}, { passive: false });\n\t\n\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\tconst fsx = frm.scrollLeft;\n\t\t\tconst fsy = frm.scrollTop;\n\t\t\tconst ix = (x + fsx) / inst.scale;\n\t\t\tconst iy = (y + fsy) / inst.scale;\n\t\t\treturn [ix, iy];\n\t\t}\n\t\n\t\tfunction updatePoint(ts) {\n\t\t\tlastTouchCount = ts.length;\n\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t}\n\t}\n\t\n\tNS.applyImage = apply;\n\n\t/**\n\t *\n\t * Dialog\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-08-17\n\t *\n\t */\n\t\n\t\n\tfunction initialize(fs, opts = {}) {\n\t\tif (fs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleRoot   : ':ncViewer',\n\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\tstyleCaption: ':ncViewerCaption',\n\t\n\t\t\tstyleOpen     : ':ncOpen',\n\t\t\tstyleVisible  : ':ncVisible',\n\t\t\tstyleInstantly: ':ncInstantly',\n\t\n\t\t\thashPrefix: 'viewer:',\n\t\t}, opts);\n\t\n\t\tconst is = new Map();\n\t\tlet prev = null;\n\t\tfor (const f of fs) {\n\t\t\tconst inst = createViewer(opts, f.id, f.frameInst, f.frame, f.caption, prev);\n\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\tis.set(f.id, inst);\n\t\t\tprev = inst;\n\t\t}\n\t\tassignEventHandler(is);\n\t\tprocessHash(is, opts['hashPrefix']);\n\t}\n\t\n\tfunction assignEventHandler(is) {\n\t\tonResize(() => {\n\t\t\tfor (const inst of is.values()) inst.fi.doResize();\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (const inst of is.values()) inst.fi.doResize();\n\t\t\t}, 200);\n\t\t});\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\tconst cur = is.get(currentId);\n\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction processHash(is, hashPrefix) {\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tif (currentId !== null && is.has(currentId)) {\n\t\t\t\tdoClose(is.get(currentId));\n\t\t\t}\n\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined && is.has(e.state['id'])) {\n\t\t\t\tdoOpen(is.get(e.state['id']));\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\tcheckHash(is, hashPrefix, location.hash);\n\t}\n\t\n\tfunction checkHash(is, hashPrefix, hash) {\n\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\tconst h = hash.replace('#' + hashPrefix, '');\n\t\tif (!h) return;\n\t\tfor (const [id, inst] of is) {\n\t\t\tif (id === h) {\n\t\t\t\tif (currentId !== null && currentId !== id) doClose(is.get(currentId));\n\t\t\t\tif (currentId === null || currentId !== id) doOpen(inst);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet currentId = null;\n\t\n\tfunction createViewer(opts, id, frameInst, frame, caption, prevInstance = null) {\n\t\tconst inst = {};\n\t\tinst.opts = opts;\n\t\tinst.fi   = frameInst;\n\t\tinst.id   = id;\n\t\n\t\tinst.dlg = document.createElement('div');\n\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\tinst.dlg.appendChild(frame);\n\t\n\t\tconst btn = document.createElement('button');\n\t\tsetClass(btn, opts.styleCloser);\n\t\tinst.dlg.appendChild(btn);\n\t\n\t\tinst.btnPrev = document.createElement('button');\n\t\tinst.btnNext = document.createElement('button');\n\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\tinst.dlg.appendChild(inst.btnNext);\n\t\n\t\tif (caption) {\n\t\t\tconst divCap = document.createElement('div');\n\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\tinst.dlg.appendChild(divCap);\n\t\t}\n\t\tdocument.body.appendChild(inst.dlg);\n\t\n\t\t_setAdjacentInstance(inst, prevInstance);\n\t\tprevInstance = inst;\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction doOpen(inst, instantly = false) {\n\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\tinst.fi.doOpen();\n\t\n\t\tif (instantly) {\n\t\t\tinst.fi.doResize();\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.id;\n\t\t\thistory.replaceState(null, '', url);\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t}, 0);\n\t\t}\n\t\tcurrentId = inst.id;\n\t\n\t\tconst sty = getComputedStyle(document.documentElement);\n\t\tif (sty.marginTop) {\n\t\t\tinst.dlg.style.top = sty.marginTop;\n\t\t}\n\t}\n\t\n\tfunction doClose(inst, instantly = false) {\n\t\tinst.fi.doClose();\n\t\n\t\tif (instantly) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t} else {\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t}\n\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\tcurrentId = null;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setAdjacentInstance(inst, prev) {\n\t\tinst.btnNext.style.display = 'none';\n\t\tif (prev) {\n\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(prev, true);\n\t\t\t});\n\t\t\t_setNextInstance(prev, inst);\n\t\t} else {\n\t\t\tinst.btnPrev.style.display = 'none';\n\t\t}\n\t}\n\t\n\tfunction _setNextInstance(inst, next) {\n\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tdoClose(inst, true);\n\t\t\tdoOpen(next, true);\n\t\t});\n\t\tinst.btnNext.style.display = null;\n\t}\n\t\n\tfunction _onOpen(inst, e) {\n\t\te.preventDefault();\n\t\tdoOpen(inst);\n\t\n\t\tif (location.hash) {\n\t\t\tconst newUrl = location.href.substring(0, location.href.indexOf('#'));\n\t\t\thistory.replaceState(null, '', newUrl);\n\t\t}\n\t\tconst url = '#' + inst.opts.hashPrefix + inst.id;\n\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t}\n\t\n\tfunction _onClose(e) {\n\t\te.preventDefault();\n\t\thistory.back();\n\t}\n\t\n\n})(window['NACSS']['viewer']);\n"]}