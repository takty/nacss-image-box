{"version":3,"sources":["image-box-inside.js"],"names":["window","NACSS","NS","enableClass","enabled","tar","cls","startsWith","dataset","substr","classList","add","remove","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","document","addEventListener","l","passive","ST_STATE_OPEN","ST_STATE_VISIBLE","ST_STATE_IMMEDIATELY","currentId","checkHash","hash","objs","location","indexOf","ih","replace","i","length","_hash","doClose","doOpen","modifyImageAnchorStyle","as","force","fas","ret","a","href","isImageUrl","imgs","getElementsByTagName","img","src","querySelector","console","log","filterImageLink","ImageBox","url","ss","split","toLowerCase","getTouchPoint","ts","x","y","pageX","pageXOffset","pageY","pageYOffset","getCursorPoint","e","imageBox","querySelectorAll","SEL_TARGET","SEL_TARGET_IMAGE_BOX","setAdjacentImageBox","setInitialSize","setTimeout","state","undefined","constructor","id","this","_id","_src","str","asHex","h","charCodeAt","toString","calcHash","onOpen","_frm","createElement","onClose","_img","stopPropagation","appendChild","btn","_btnPrev","_btnNext","parentNode","tagName","fcs","cap","innerHTML","body","enableMouseGesture","enableTouchGesture","prev","next","style","display","preventDefault","newUrl","history","replaceState","pushState","name","immediately","opacity","back","_isPhone","innerWidth","_scale","winAs","offsetWidth","offsetHeight","imgAs","_isLandscape","size","s","minWidth","minHeight","width","height","maxWidth","_baseSize","clientWidth","clientHeight","doCenteringImage","setScaledSize","scale","Math","max","min","imgW","imgH","frmW","frmH","left","top","xS","yS","isMoving","button","cx","cy","scrollLeft","scrollTop","imgCx","imgCy","deltaY","lastTouchCount","baseDist","updatePoint","f","isTouching","stopImmediatePropagation","preventWindowTouchMove","touches","dist","x1","screenX","y1","screenY","x2","y2","sqrt","pow","touchDistance","Infinity"],"mappings":"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","file":"image-box-inside.min.js","sourcesContent":["/**\n *\n * Image Box (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-15\n *\n */\n\n\nwindow.NACSS = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls) {\n\t\tif (enabled) {\n\t\t\tif (cls.startsWith(':')) tar.dataset[cls.substr(1)] = '';\n\t\t\telse tar.classList.add(cls.substr(1));\n\t\t} else {\n\t\t\tif (cls.startsWith(':')) delete tar.dataset[cls.substr(1)];\n\t\t\telse tar.classList.remove(cls.substr(1));\n\t\t}\n\t}\n\t\n\tfunction hasClass(tar, cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn typeof tar.dataset[cls.substr(1)] !== 'undefined';\n\t\t} else {\n\t\t\treturn tar.classList.contains(cls.substr(1));\n\t\t}\n\t}\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t});\n\t\n\n\tconst SEL_TARGET           = '.stile';\n\tconst SEL_TARGET_IMAGE_BOX = '.stile-image-box';\n\tconst SEL_TARGET_LINK      = '[data-stile~=\"image-box-link\"]';\n\tconst ST_BACKGROUND_IMAGE  = 'background-image';\n\n\tconst ST_IMAGE_BOX         = ':ncImageBox';\n\tconst ST_IMAGE_BOX_CLOSE   = ':ncImageBoxClose';\n\tconst ST_IMAGE_BOX_PREV    = ':ncImageBoxPrev';\n\tconst ST_IMAGE_BOX_NEXT    = ':ncImageBoxNext';\n\tconst ST_IMAGE_BOX_CAPTION = ':ncImageBoxCaption';\n\tconst ST_STATE_OPEN        = ':ncOpen';\n\tconst ST_STATE_VISIBLE     = ':ncVisible';\n\tconst ST_STATE_IMMEDIATELY = ':ncImmediately';\n\tconst ST_STATE_LOADED      = ':ncLoaded';\n\tconst SIZE_BOX_PADDING     = '6rem';\n\tconst ZOOM_RATE_MAX        = 5;\n\tconst HASH_PREFIX          = 'image:';\n\n\tconst ST_IMAGE_BOX_OPENER         = '.image-box-opener';\n\tconst ST_IMAGE_BOX_OPENER_WRAPPER = '.image-box-opener-wrapper';\n\n\n\tlet currentId = null;\n\n\n\tNS.imageBox = () => {\n\t\tconst objs = [];\n\n\t\tconst as1 = document.querySelectorAll(SEL_TARGET + ' a');\n\t\tmodifyImageAnchorStyle(as1, objs);\n\t\tconst as2 = document.querySelectorAll(SEL_TARGET_IMAGE_BOX + ' a');\n\t\tmodifyImageAnchorStyle(as2, objs);\n\t\tconst as3 = document.querySelectorAll('a' + SEL_TARGET_LINK);\n\t\tmodifyImageAnchorStyle(as3, objs, true);\n\n\t\tfor (let i = 0; i < objs.length; i += 1) {\n\t\t\tobjs[i].setAdjacentImageBox(\n\t\t\t\t(0 < i)               ? objs[i - 1] : null,\n\t\t\t\t(i < objs.length - 1) ? objs[i + 1] : null\n\t\t\t);\n\t\t}\n\n\t\tonResize(() => {\n\t\t\tfor (let i = 0; i < objs.length; i += 1) objs[i].setInitialSize();\n\t\t\tsetTimeout(() => { for (let i = 0; i < objs.length; i += 1) objs[i].setInitialSize(); }, 200);\n\t\t});\n\n\t\twindow.addEventListener('popstate', (e) => {\n\t\t\tif (currentId !== null) objs[currentId].doClose();\n\t\t\tif (e.state && e.state['name'] === 'stile-image-box' && e.state['id'] !== undefined) {\n\t\t\t\tobjs[e.state['id']].doOpen();\n\t\t\t}\n\t\t});\n\t\tcheckHash(location.hash, objs);\n\t\twindow.addEventListener('hashchange', () => { checkHash(location.hash, objs) });\n\t};\n\n\tfunction checkHash(hash, objs) {\n\t\tif (location.hash.indexOf('#' + HASH_PREFIX) !== 0) return;\n\t\tconst ih = hash.replace('#' + HASH_PREFIX, '');\n\t\tif (!ih) return;\n\t\tfor (let i = 0; i < objs.length; i += 1) {\n\t\t\tif (objs[i]._hash === ih) {\n\t\t\t\tif (currentId !== null && currentId !== i) objs[currentId].doClose();\n\t\t\t\tif (currentId === null || currentId !== i) objs[i].doOpen();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction modifyImageAnchorStyle(as, objs, force = false) {\n\t\tconst fas = force ? as : filterImageLink(as);\n\t\tfor (let i = 0; i < fas.length; i += 1) { objs.push(new ImageBox(fas[i], objs.length)); }\n\t}\n\n\tfunction filterImageLink(as) {\n\t\tconst ret = [];\n\t\tfor (let i = 0; i < as.length; i += 1) {\n\t\t\tconst a = as[i];\n\t\t\t// if (!hasClass(a, '.link-image')) continue;\n\t\t\tconst href = a.href;\n\t\t\tif (!href || !isImageUrl(href)) continue;\n\t\t\tconst imgs = a.getElementsByTagName('img');\n\t\t\tif (0 < imgs.length) {\n\t\t\t\tconst img = imgs[0];\n\t\t\t\tconst src = img.dataset.src ? img.dataset.src : img.src;\n\t\t\t\tif (!src || !isImageUrl(src)) continue;\n\t\t\t\tret.push(a);\n\t\t\t} else {\n\t\t\t\tconst div = a.querySelector('*[data-stile~=\"' + ST_BACKGROUND_IMAGE + '\"]');\n\t\t\t\tif (div) ret.push(a);\n\t\t\t}\n\t\t}\n\t\tconsole.log(ret);\n\t\treturn ret;\n\t}\n\n\tfunction isImageUrl(url) {\n\t\turl = url.split('?')[0];\n\t\turl = url.toLowerCase();\n\t\tconst ss = url.split('.');\n\t\tconst ext = ss[ss.length - 1];\n\t\tswitch (ext) {\n\t\t\tcase 'jpeg':\n\t\t\tcase 'jpg':\n\t\t\tcase 'png':\n\t\t\tcase 'gif':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction getTouchPoint(ts) {\n\t\tlet x = 0, y = 0;\n\t\tif (ts.length === 1) {\n\t\t\tx = ts[0].pageX - window.pageXOffset;\n\t\t\ty = ts[0].pageY - window.pageYOffset;\n\t\t} else if (2 <= ts.length) {\n\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - window.pageXOffset;\n\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - window.pageYOffset;\n\t\t}\n\t\treturn [x, y];\n\t}\n\n\tfunction touchDistance(ts) {\n\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t}\n\n\tfunction preventWindowTouchMove(f) {\n\t\tlet isTouching = false;\n\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\tif (!isTouching) return;\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}, { passive: false });\n\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t}\n\n\tfunction getCursorPoint(e) {\n\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tclass ImageBox {\n\n\t\tconstructor(a, id) {\n\t\t\tthis._id   = id;\n\t\t\tthis._src  = a.href;\n\t\t\tthis._hash = calcHash(this._src);\n\n\t\t\ta.addEventListener('click', (e) => { this.onOpen(e); });\n\t\t\tenableClass(true, a, ST_IMAGE_BOX_OPENER);\n\n\t\t\tthis._frm = document.createElement('div');\n\t\t\tenableClass(true, this._frm, ST_IMAGE_BOX);\n\t\t\tthis._frm.addEventListener('click', (e) => { this.onClose(e); });\n\n\t\t\tthis._img = document.createElement('img');\n\t\t\tthis._img.addEventListener('click', (e) => { e.stopPropagation(); });\n\t\t\tthis._frm.appendChild(this._img);\n\n\t\t\tconst btn = document.createElement('span');\n\t\t\tenableClass(true, btn, ST_IMAGE_BOX_CLOSE);\n\t\t\tthis._frm.appendChild(btn);\n\n\t\t\tthis._btnPrev = document.createElement('span');\n\t\t\tthis._btnNext = document.createElement('span');\n\t\t\tenableClass(true, this._btnPrev, ST_IMAGE_BOX_PREV);\n\t\t\tenableClass(true, this._btnNext, ST_IMAGE_BOX_NEXT);\n\t\t\tthis._frm.appendChild(this._btnPrev);\n\t\t\tthis._frm.appendChild(this._btnNext);\n\n\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\tconst cap = document.createElement('div');\n\t\t\t\t\tcap.innerHTML = '<span>' + fcs[0].innerHTML + '</span>';\n\t\t\t\t\tenableClass(true, cap, ST_IMAGE_BOX_CAPTION);\n\t\t\t\t\tthis._frm.appendChild(cap);\n\t\t\t\t}\n\t\t\t\tenableClass(true, a.parentNode, ST_IMAGE_BOX_OPENER_WRAPPER);\n\t\t\t}\n\t\t\tdocument.body.appendChild(this._frm);\n\n\t\t\tthis.enableMouseGesture();\n\t\t\tthis.enableTouchGesture();\n\t\t}\n\n\t\tsetAdjacentImageBox(prev, next) {\n\t\t\tif (prev) {\n\t\t\t\tthis._btnPrev.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.doClose(true);\n\t\t\t\t\tprev.doOpen(true);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._btnPrev.style.display = 'none';\n\t\t\t}\n\t\t\tif (next) {\n\t\t\t\tthis._btnNext.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.doClose(true);\n\t\t\t\t\tnext.doOpen(true);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._btnNext.style.display = 'none';\n\t\t\t}\n\t\t}\n\n\t\tonOpen(e) {\n\t\t\tif (e) e.preventDefault();\n\t\t\tthis.doOpen();\n\n\t\t\tif (location.hash) {\n\t\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\t\thistory.replaceState(null, '', newUrl);\n\t\t\t}\n\t\t\tconst hash = '#' + HASH_PREFIX + this._hash;\n\t\t\thistory.pushState({ name: 'stile-image-box', id: this._id }, null, hash);\n\t\t}\n\n\t\tdoOpen(immediately = false) {\n\t\t\tenableClass(true, this._frm, ST_STATE_OPEN);\n\t\t\tconst img = this._img;\n\t\t\tif (!img.src) {\n\t\t\t\timg.style.opacity = '0';\n\t\t\t\timg.src = this._src;\n\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\tthis.setInitialSize();\n\t\t\t\t\tenableClass(true, this._frm, ST_STATE_LOADED);\n\t\t\t\t\timg.style.opacity = '0.01';  // for smooth fading on iOS\n\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 100);  // Delay for smooth fading on iOS\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (immediately) {\n\t\t\t\tthis.setInitialSize();\n\t\t\t\tenableClass(true, this._frm, ST_STATE_IMMEDIATELY);\n\t\t\t\tenableClass(true, this._frm, ST_STATE_VISIBLE);\n\t\t\t\tsetTimeout(() => { enableClass(false, this._frm, ST_STATE_IMMEDIATELY); }, 20);\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.setInitialSize();\n\t\t\t\t\tenableClass(true, this._frm, ST_STATE_VISIBLE);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tcurrentId = this._id;\n\t\t}\n\n\t\t/* eslint-disable class-methods-use-this */\n\t\tonClose(e) {\n\t\t\te.preventDefault();\n\t\t\thistory.back();\n\t\t}\n\n\t\tdoClose(immediately = false) {\n\t\t\tif (immediately) {\n\t\t\t\tenableClass(true, this._frm, ST_STATE_IMMEDIATELY);\n\t\t\t\tenableClass(false, this._frm, ST_STATE_VISIBLE);\n\t\t\t\tsetTimeout(() => { enableClass(false, this._frm, ST_STATE_IMMEDIATELY); }, 20);\n\t\t\t} else {\n\t\t\t\tenableClass(false, this._frm, ST_STATE_VISIBLE);\n\t\t\t}\n\t\t\tsetTimeout(() => { enableClass(false, this._frm, ST_STATE_OPEN); }, 200);\n\t\t\tcurrentId = null;\n\t\t}\n\n\t\tsetInitialSize() {  // Called also when 'onResize'\n\t\t\tthis._isPhone = (window.innerWidth < /*minWindowWidth*/600);\n\t\t\tthis._scale   = 1;\n\n\t\t\tconst winAs = this._frm.offsetWidth / this._frm.offsetHeight;\n\t\t\tconst imgAs = this._img.offsetWidth / this._img.offsetHeight;\n\t\t\tthis._isLandscape = (winAs < imgAs);\n\n\t\t\tconst size = this._isPhone ? '100%' : 'calc(100% - ' + SIZE_BOX_PADDING + ')';\n\t\t\tconst s = this._img.style;\n\t\t\ts.minWidth  = '';\n\t\t\ts.minHeight = '';\n\t\t\tif (this._isLandscape) {\n\t\t\t\ts.width    = size;\n\t\t\t\ts.height   = 'auto';\n\t\t\t} else {\n\t\t\t\ts.width    = 'auto';\n\t\t\t\ts.height   = size;\n\t\t\t\ts.maxWidth = 'none';\n\t\t\t}\n\t\t\tthis._baseSize = this._isLandscape ? this._frm.clientWidth : this._frm.clientHeight;\n\t\t\tthis.doCenteringImage();\n\t\t}\n\n\t\tsetScaledSize(scale) {\n\t\t\tthis._scale = Math.max(1, Math.min(ZOOM_RATE_MAX, scale));\n\t\t\tlet size = (this._baseSize * this._scale) + 'px';\n\t\t\tif (!this._isPhone) {\n\t\t\t\tsize = `calc(${size} - ${SIZE_BOX_PADDING})`;\n\t\t\t}\n\t\t\tif (this._isLandscape) this._img.style.minWidth = size;\n\t\t\telse this._img.style.minHeight = size;\n\t\t\tthis.doCenteringImage();\n\t\t}\n\n\t\tdoCenteringImage() {\n\t\t\tconst imgW = this._img.offsetWidth, imgH = this._img.offsetHeight;\n\t\t\tconst frmW = this._frm.clientWidth, frmH = this._frm.clientHeight;\n\t\t\tconst s = this._img.style;\n\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t}\n\n\t\tenableMouseGesture() {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet isMoving = false;\n\n\t\t\tthis._frm.addEventListener('mousedown', (e) => {\n\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\te.preventDefault();\n\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\tisMoving = true;\n\t\t\t});\n\t\t\tthis._frm.addEventListener('mousemove', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tthis._frm.scrollLeft += xS - cx;\n\t\t\t\tthis._frm.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\t\t\t});\n\t\t\tthis._frm.addEventListener('mousedrag', (e) => {\n\t\t\t\tif (!isMoving) return;\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tthis._frm.addEventListener('mouseup', () => { isMoving = false; });\n\n\t\t\tthis._frm.addEventListener('wheel', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\tconst imgCx = (cx + this._frm.scrollLeft) / this._scale;\n\t\t\t\tconst imgCy = (cy + this._frm.scrollTop)  / this._scale;\n\n\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\tthis.setScaledSize(this._scale * s);\n\n\t\t\t\tthis._frm.scrollLeft = imgCx * this._scale - cx;\n\t\t\t\tthis._frm.scrollTop  = imgCy * this._scale - cy;\n\t\t\t}, true);\n\t\t}\n\n\t\tenableTouchGesture() {\n\t\t\tlet xS = 0, yS = 0;\n\t\t\tlet lastTouchCount = 0;\n\t\t\tlet baseDist = 0;\n\n\t\t\tpreventWindowTouchMove(this._frm);  // for Android\n\n\t\t\tthis._frm.addEventListener('touchstart', (e) => {\n\t\t\t\tbaseDist = 0;\n\t\t\t\tupdatePoint(e.touches);\n\t\t\t});\n\t\t\tthis._frm.addEventListener('touchmove', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\n\t\t\t\tconst ts = e.touches;\n\t\t\t\tif (lastTouchCount !== ts.length) updatePoint(ts);\n\n\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\t\tthis._frm.scrollLeft += xS - cx;\n\t\t\t\tthis._frm.scrollTop  += yS - cy;\n\t\t\t\txS = cx;\n\t\t\t\tyS = cy;\n\n\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\tconst imgCx = (cx + this._frm.scrollLeft) / this._scale;\n\t\t\t\t\tconst imgCy = (cy + this._frm.scrollTop)  / this._scale;\n\t\t\t\t\tconst dist = touchDistance(ts);\n\n\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\tconst s = dist / (baseDist * this._scale);\n\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\tthis.setScaledSize(this._scale * s);\n\n\t\t\t\t\t\t\tthis._frm.scrollLeft = imgCx * this._scale - cx;\n\t\t\t\t\t\t\tthis._frm.scrollTop  = imgCy * this._scale - cy;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbaseDist = dist / this._scale;\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\n\t\t\tfunction updatePoint(ts) {\n\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t[xS, yS] = getTouchPoint(ts);\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\n})(window.NACSS);\n"]}