window.NACSS=window.NACSS??{},function(e){function t(e){const t=window.pageXOffset,n=window.pageYOffset;let s=0,o=0;return 1===e.length?(s=e[0].pageX-t,o=e[0].pageY-n):2<=e.length&&(s=(e[0].pageX+e[1].pageX)/2-t,o=(e[0].pageY+e[1].pageY)/2-n),[s,o]}function n(e){return[e.pageX-window.pageXOffset,e.pageY-window.pageYOffset]}function s(e,t,n){const s=n.substr(1);n.startsWith(":")?e?t.dataset[s]="":delete t.dataset[s]:e?t.classList.add(s):t.classList.remove(s)}!function(){function i(e,t,n){if(0!==location.hash.indexOf("#"+e.hashPrefix))return;const s=t.replace("#"+e.hashPrefix,"");if(s)for(let t=0;t<n.length;t+=1)if(n[t]._hash===s){null!==e.curId&&e.curId!==t&&m(n[e.curId]),null!==e.curId&&e.curId===t||d(n[t]);break}}let c=null,a=0;function r(e,o){const i={};i._id=a,i._cm=e,i._src=o.href,i._hash=function(e,t=!0){let n=2166136261;for(let t=0;t<e.length;t+=1)n^=e.charCodeAt(t),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return t?("0000000"+(n>>>0).toString(16)).substr(-8):n>>>0}(i._src),o.addEventListener("click",(e=>function(e,t,n){if(t.preventDefault(),d(e),location.hash){const e=location.href.substr(0,location.href.indexOf("#"));history.replaceState(null,"",e)}const s="#"+e._cm.hashPrefix+n;history.pushState({name:"nc-viewer",id:e._id},null,s)}(i,e,i._hash))),s(!0,o,i._cm.styleOpener),i._frm=document.createElement("div"),s(!0,i._frm,i._cm.styleRoot),i._frm.addEventListener("click",(e=>function(e){e.preventDefault(),history.back()}(e))),i._img=document.createElement("img"),i._img.addEventListener("click",(e=>e.stopPropagation())),i._frm.appendChild(i._img);const r=document.createElement("button");if(s(!0,r,i._cm.styleCloser),i._frm.appendChild(r),i._btnPrev=document.createElement("button"),i._btnNext=document.createElement("button"),s(!0,i._btnPrev,i._cm.stylePrev),s(!0,i._btnNext,i._cm.styleNext),i._frm.appendChild(i._btnPrev),i._frm.appendChild(i._btnNext),"FIGURE"===o.parentNode.tagName){const e=o.parentNode.getElementsByTagName("figcaption");if(0<e.length){const t=document.createElement("div");t.innerHTML="<span>"+e[0].innerHTML+"</span>",s(!0,t,i._cm.styleCaption),i._frm.appendChild(t)}s(!0,o.parentNode,i._cm.styleOpenerWrapper)}return document.body.appendChild(i._frm),function(e,t){let s=0,o=0,i=!1;t.addEventListener("mousedown",(e=>{e.button||(e.preventDefault(),[s,o]=n(e),i=!0)})),t.addEventListener("mousemove",(e=>{if(!i)return;e.stopPropagation(),e.preventDefault();const[c,a]=n(e);t.scrollLeft+=s-c,t.scrollTop+=o-a,s=c,o=a})),t.addEventListener("mousedrag",(e=>{i&&(e.stopPropagation(),e.preventDefault())})),t.addEventListener("mouseup",(()=>{i=!1})),t.addEventListener("wheel",(s=>{s.stopPropagation(),s.preventDefault();const[o,i]=n(s),c=(o+t.scrollLeft)/e._scale,a=(i+t.scrollTop)/e._scale,r=0>s.deltaY?1.1:.9;f(e,e._scale*r),t.scrollLeft=c*e._scale-o,t.scrollTop=a*e._scale-i}),!0)}(i,i._frm),function(e,n){let s=0,o=0,i=0,c=0;function a(e){i=e.length,[s,o]=t(e)}(function(e){let t=!1;window.addEventListener("touchmove",(e=>{t&&(e.preventDefault(),e.stopImmediatePropagation())}),{passive:!1}),e.addEventListener("touchstart",(()=>{t=!0})),e.addEventListener("touchend",(()=>{t=!1}))})(n),n.addEventListener("touchstart",(e=>{c=0,a(e.touches)})),n.addEventListener("touchmove",(r=>{r.preventDefault(),r.stopPropagation();const l=r.touches;i!==l.length&&a(l);const[d,m]=t(l);if(n.scrollLeft+=s-d,n.scrollTop+=o-m,s=d,o=m,2<=l.length){const t=(d+n.scrollLeft)/e._scale,s=(m+n.scrollTop)/e._scale,o=function(e){const t=e[0].screenX,n=e[0].screenY,s=e[1].screenX,o=e[1].screenY;return Math.sqrt(Math.pow(s-t,2)+Math.pow(o-n,2))}(l);if(c){const i=o/(c*e._scale);i&&i!==1/0&&(f(e,e._scale*i),n.scrollLeft=t*e._scale-d,n.scrollTop=s*e._scale-m)}c=o/e._scale}}),{passive:!1})}(i,i._frm),function(e,t){e._btnNext.style.display="none",t?(e._btnPrev.addEventListener("click",(n=>{n.stopPropagation(),m(e,!0),d(t,!0)})),function(e,t){e._btnNext.addEventListener("click",(n=>{n.stopPropagation(),m(e,!0),d(t,!0)})),e._btnNext.style.display=null}(t,e)):e._btnPrev.style.display="none"}(i,c),c=i,a+=1,i}function l(e){e._isPhone=window.innerWidth<e._cm.minWindowWidth,e._scale=1;const t=e._frm.offsetWidth/e._frm.offsetHeight,n=e._img.offsetWidth/e._img.offsetHeight;e._isLandscape=t<n;const s=e._isPhone?"100%":"calc(100% - "+e._cm.padding+")",o=e._img.style;o.minWidth="",o.minHeight="",e._isLandscape?(o.width=s,o.height="auto"):(o.width="auto",o.height=s,o.maxWidth="none"),e._baseSize=e._isLandscape?e._frm.clientWidth:e._frm.clientHeight,_(e._frm,e._img)}function d(e,t=!1){s(!0,e._frm,e._cm.styleOpen);const n=e._img;n.src||(n.style.opacity="0",n.src=e._src,n.addEventListener("load",(()=>{l(e),s(!0,e._frm,e._cm.styleLoaded),setTimeout((()=>{n.style.opacity="1"}),0)}))),t?(l(e),s(!0,e._frm,e._cm.styleInstantly),s(!0,e._frm,e._cm.styleVisible),setTimeout((()=>{s(!1,e._frm,e._cm.styleInstantly)}),20)):setTimeout((()=>{l(e),s(!0,e._frm,e._cm.styleVisible)}),0),e._cm.curId=e._id}function m(e,t=!1){t?(s(!0,e._frm,e._cm.styleInstantly),s(!1,e._frm,e._cm.styleVisible),setTimeout((()=>{s(!1,e._frm,e._cm.styleInstantly)}),20)):s(!1,e._frm,e._cm.styleVisible),setTimeout((()=>{s(!1,e._frm,e._cm.styleOpen)}),200),e._cm.curId=null}function f(e,t){e._scale=Math.max(1,Math.min(e._cm.maxZoomRate,t));let n=e._baseSize*e._scale+"px";e._isPhone||(n=`calc(${n} - ${e._cm.padding})`),e._isLandscape?e._img.style.minWidth=n:e._img.style.minHeight=n,_(e._frm,e._img)}function _(e,t){const n=t.offsetWidth,s=t.offsetHeight,o=e.clientWidth,i=e.clientHeight,c=t.style;c.left=n<o?(o-n)/2+"px":0,c.top=s<i?(i-s)/2+"px":0}e.viewer=function(e=[],t={}){if(0===e.length)return;const n=Object.assign({styleOpener:":ncImageBoxOpener",styleOpenerWrapper:":ncImageBoxOpenerWrapper",styleRoot:":ncImageBox",styleCloser:":ncImageBoxCloser",stylePrev:":ncImageBoxPrev",styleNext:":ncImageBoxNext",styleCaption:":ncImageBoxCaption",styleOpen:":ncOpen",styleVisible:":ncVisible",styleInstantly:":ncInstantly",styleLoaded:":ncLoaded",minWindowWidth:600,maxZoomRate:5,hashPrefix:"image:",padding:"6rem",curId:null},t),s=[];for(const t of e)s.push(r(n,t));!function(e,t=!1){t&&e();o.push(function(e){let t;return(...n)=>{t||(t=!0,requestAnimationFrame((()=>{t=!1,e(...n)})))}}(e))}((()=>{for(const e of s)l(e);setTimeout((()=>{for(const e of s)l(e)}),200)})),window.addEventListener("keydown",(e=>{if(null===n.curId)return;const t=s[n.curId],o=!e.altKey&&!e.ctrlKey&&!e.shiftKey;"Escape"===e.key&&o?t._frm.click():"ArrowLeft"===e.key&&o?t._btnPrev.click():"ArrowRight"===e.key&&o&&t._btnNext.click()})),window.addEventListener("popstate",(e=>{null!==n.curId&&m(s[n.curId]),e.state&&"nc-viewer"===e.state.name&&void 0!==e.state.id&&d(s[e.state.id])})),window.addEventListener("hashchange",(()=>i(n,location.hash,s))),i(n,location.hash,s)}}();const o=[];document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const e of o)e()}),{passive:!0})}))}(window.NACSS);
//# sourceMappingURL=image-box.min.js.map