window.NACSS=window.NACSS||{},function(t){function e(t,e,s){t?s.startsWith(":")?e.dataset[s.substr(1)]="":e.classList.add(s.substr(1)):s.startsWith(":")?delete e.dataset[s.substr(1)]:e.classList.remove(s.substr(1))}const s=[];function i(t,e=!1){e&&t(),s.push(function(t){let e;return(...s)=>{e||(e=!0,requestAnimationFrame((()=>{e=!1,t(...s)})))}}(t))}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const t of s)t()}),{passive:!0})}));const n=":ncOpen",o=":ncVisible",a=":ncImmediately";let h=null;function r(t,e){if(0!==location.hash.indexOf("#image:"))return;const s=t.replace("#image:","");if(s)for(let t=0;t<e.length;t+=1)if(e[t]._hash===s){null!==h&&h!==t&&e[h].doClose(),null!==h&&h===t||e[t].doOpen();break}}function l(t,e,s=!1){const i=s?t:function(t){const e=[];for(let s=0;s<t.length;s+=1){const i=t[s],n=i.href;if(!n||!c(n))continue;const o=i.getElementsByTagName("img");if(0<o.length){const t=o[0],s=t.dataset.src?t.dataset.src:t.src;if(!s||!c(s))continue;e.push(i)}else{i.querySelector('*[data-stile~="background-image"]')&&e.push(i)}}return console.log(e),e}(t);for(let t=0;t<i.length;t+=1)e.push(new f(i[t],e.length))}function c(t){const e=(t=(t=t.split("?")[0]).toLowerCase()).split(".");switch(e[e.length-1]){case"jpeg":case"jpg":case"png":case"gif":return!0}return!1}function d(t){let e=0,s=0;return 1===t.length?(e=t[0].pageX-window.pageXOffset,s=t[0].pageY-window.pageYOffset):2<=t.length&&(e=(t[0].pageX+t[1].pageX)/2-window.pageXOffset,s=(t[0].pageY+t[1].pageY)/2-window.pageYOffset),[e,s]}function m(t){return[t.pageX-window.pageXOffset,t.pageY-window.pageYOffset]}t.imageBox=()=>{const t=[];l(document.querySelectorAll(".stile a"),t);l(document.querySelectorAll(".stile-image-box a"),t);l(document.querySelectorAll('a[data-stile~="image-box-link"]'),t,!0);for(let e=0;e<t.length;e+=1)t[e].setAdjacentImageBox(0<e?t[e-1]:null,e<t.length-1?t[e+1]:null);i((()=>{for(let e=0;e<t.length;e+=1)t[e].setInitialSize();setTimeout((()=>{for(let e=0;e<t.length;e+=1)t[e].setInitialSize()}),200)})),window.addEventListener("popstate",(e=>{null!==h&&t[h].doClose(),e.state&&"stile-image-box"===e.state.name&&void 0!==e.state.id&&t[e.state.id].doOpen()})),r(location.hash,t),window.addEventListener("hashchange",(()=>{r(location.hash,t)}))};class f{constructor(t,s){this._id=s,this._src=t.href,this._hash=function(t,e=!0){let s=2166136261;for(let e=0;e<t.length;e+=1)s^=t.charCodeAt(e),s+=(s<<1)+(s<<4)+(s<<7)+(s<<8)+(s<<24);return e?("0000000"+(s>>>0).toString(16)).substr(-8):s>>>0}(this._src),t.addEventListener("click",(t=>{this.onOpen(t)})),e(!0,t,".image-box-opener"),this._frm=document.createElement("div"),e(!0,this._frm,":ncImageBox"),this._frm.addEventListener("click",(t=>{this.onClose(t)})),this._img=document.createElement("img"),this._img.addEventListener("click",(t=>{t.stopPropagation()})),this._frm.appendChild(this._img);const i=document.createElement("span");if(e(!0,i,":ncImageBoxClose"),this._frm.appendChild(i),this._btnPrev=document.createElement("span"),this._btnNext=document.createElement("span"),e(!0,this._btnPrev,":ncImageBoxPrev"),e(!0,this._btnNext,":ncImageBoxNext"),this._frm.appendChild(this._btnPrev),this._frm.appendChild(this._btnNext),"FIGURE"===t.parentNode.tagName){const s=t.parentNode.getElementsByTagName("figcaption");if(0<s.length){const t=document.createElement("div");t.innerHTML="<span>"+s[0].innerHTML+"</span>",e(!0,t,":ncImageBoxCaption"),this._frm.appendChild(t)}e(!0,t.parentNode,".image-box-opener-wrapper")}document.body.appendChild(this._frm),this.enableMouseGesture(),this.enableTouchGesture()}setAdjacentImageBox(t,e){t?this._btnPrev.addEventListener("click",(e=>{e.stopPropagation(),this.doClose(!0),t.doOpen(!0)})):this._btnPrev.style.display="none",e?this._btnNext.addEventListener("click",(t=>{t.stopPropagation(),this.doClose(!0),e.doOpen(!0)})):this._btnNext.style.display="none"}onOpen(t){if(t&&t.preventDefault(),this.doOpen(),location.hash){const t=location.href.substr(0,location.href.indexOf("#"));history.replaceState(null,"",t)}const e="#image:"+this._hash;history.pushState({name:"stile-image-box",id:this._id},null,e)}doOpen(t=!1){e(!0,this._frm,n);const s=this._img;s.src||(s.style.opacity="0",s.src=this._src,s.addEventListener("load",(()=>{this.setInitialSize(),e(!0,this._frm,":ncLoaded"),s.style.opacity="0.01",setTimeout((()=>{s.style.opacity="1"}),100)}))),t?(this.setInitialSize(),e(!0,this._frm,a),e(!0,this._frm,o),setTimeout((()=>{e(!1,this._frm,a)}),20)):setTimeout((()=>{this.setInitialSize(),e(!0,this._frm,o)}),0),h=this._id}onClose(t){t.preventDefault(),history.back()}doClose(t=!1){t?(e(!0,this._frm,a),e(!1,this._frm,o),setTimeout((()=>{e(!1,this._frm,a)}),20)):e(!1,this._frm,o),setTimeout((()=>{e(!1,this._frm,n)}),200),h=null}setInitialSize(){this._isPhone=window.innerWidth<600,this._scale=1;const t=this._frm.offsetWidth/this._frm.offsetHeight,e=this._img.offsetWidth/this._img.offsetHeight;this._isLandscape=t<e;const s=this._isPhone?"100%":"calc(100% - 6rem)",i=this._img.style;i.minWidth="",i.minHeight="",this._isLandscape?(i.width=s,i.height="auto"):(i.width="auto",i.height=s,i.maxWidth="none"),this._baseSize=this._isLandscape?this._frm.clientWidth:this._frm.clientHeight,this.doCenteringImage()}setScaledSize(t){this._scale=Math.max(1,Math.min(5,t));let e=this._baseSize*this._scale+"px";this._isPhone||(e=`calc(${e} - 6rem)`),this._isLandscape?this._img.style.minWidth=e:this._img.style.minHeight=e,this.doCenteringImage()}doCenteringImage(){const t=this._img.offsetWidth,e=this._img.offsetHeight,s=this._frm.clientWidth,i=this._frm.clientHeight,n=this._img.style;n.left=t<s?(s-t)/2+"px":0,n.top=e<i?(i-e)/2+"px":0}enableMouseGesture(){let t=0,e=0,s=!1;this._frm.addEventListener("mousedown",(i=>{i.button||(i.preventDefault(),[t,e]=m(i),s=!0)})),this._frm.addEventListener("mousemove",(i=>{if(!s)return;i.stopPropagation(),i.preventDefault();const[n,o]=m(i);this._frm.scrollLeft+=t-n,this._frm.scrollTop+=e-o,t=n,e=o})),this._frm.addEventListener("mousedrag",(t=>{s&&(t.stopPropagation(),t.preventDefault())})),this._frm.addEventListener("mouseup",(()=>{s=!1})),this._frm.addEventListener("wheel",(t=>{t.stopPropagation(),t.preventDefault();const[e,s]=m(t),i=(e+this._frm.scrollLeft)/this._scale,n=(s+this._frm.scrollTop)/this._scale,o=0>t.deltaY?1.1:.9;this.setScaledSize(this._scale*o),this._frm.scrollLeft=i*this._scale-e,this._frm.scrollTop=n*this._scale-s}),!0)}enableTouchGesture(){let t=0,e=0,s=0,i=0;function n(i){s=i.length,[t,e]=d(i)}!function(t){let e=!1;window.addEventListener("touchmove",(t=>{e&&(t.preventDefault(),t.stopImmediatePropagation())}),{passive:!1}),t.addEventListener("touchstart",(()=>{e=!0})),t.addEventListener("touchend",(()=>{e=!1}))}(this._frm),this._frm.addEventListener("touchstart",(t=>{i=0,n(t.touches)})),this._frm.addEventListener("touchmove",(o=>{o.preventDefault(),o.stopPropagation();const a=o.touches;s!==a.length&&n(a);const[h,r]=d(a);if(this._frm.scrollLeft+=t-h,this._frm.scrollTop+=e-r,t=h,e=r,2<=a.length){const t=(h+this._frm.scrollLeft)/this._scale,e=(r+this._frm.scrollTop)/this._scale,s=function(t){const e=t[0].screenX,s=t[0].screenY,i=t[1].screenX,n=t[1].screenY;return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-s,2))}(a);if(i){const n=s/(i*this._scale);n&&n!==1/0&&(this.setScaledSize(this._scale*n),this._frm.scrollLeft=t*this._scale-h,this._frm.scrollTop=e*this._scale-r)}i=s/this._scale}}),{passive:!1})}}}(window.NACSS);
//# sourceMappingURL=image-box-inside.min.js.map