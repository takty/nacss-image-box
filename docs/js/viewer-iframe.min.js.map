{"version":3,"sources":["viewer-iframe.js"],"names":["window","NS","setClass","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","checkHash","is","hashPrefix","hash","location","indexOf","ih","replace","i","length","currentId","doClose","doOpen","document","addEventListener","l","passive","applyIframe","os","ifms","opts","Object","assign","styleOpener","styleOpenerWrapper","fs","map","o","str","asHex","h","charCodeAt","toString","calcHash","src","frameInst","frame","ifm","styleIframeFrame","styleLoaded","url","URL","ps","URLSearchParams","search","append","filterSource","removeAttribute","setAttribute","style","aspectRatio","w","f","parseInt","width","height","sW","sH","extractIframeSize","inst","scale","realScale","baseSize","isLs","margin","frm","createElement","e","stopPropagation","appendChild","hasAttribute","opacity","setTimeout","contentDocument","setSource","contentWindow","postMessage","pause","createIframeFrame","assignIframeOpenerStyle","opener","caption","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","fi","id","instanceCount","dlg","preventDefault","history","back","_onClose","btn","btnPrev","btnNext","divCap","innerHTML","body","prev","display","next","_setNextInstance","_setAdjacentInstance","prevInstance","createViewer","newUrl","href","replaceState","pushState","name","_onOpen","doResize","altKey","ctrlKey","shiftKey","cur","click","assignEventHandler","state","undefined","processHash","initialize","instantly"],"mappings":"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","file":"viewer-iframe.min.js","sourcesContent":["/**\n *\n * Viewer\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\nwindow['NACSS']           = window['NACSS']           || {};\nwindow['NACSS']['viewer'] = window['NACSS']['viewer'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Functions for Hash\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-15\n\t *\n\t */\n\t\n\t\n\tfunction calcHash(str, asHex = true) {\n\t\tlet h = 0x811c9dc5;\n\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\th ^= str.charCodeAt(i);\n\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t}\n\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\treturn h >>> 0;\n\t}\n\t\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n\t/**\n\t *\n\t * Iframe Viewer\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-26\n\t *\n\t */\n\t\n\t\n\tfunction apply(os, ifms, opts = {}) {\n\t\tif (os.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t}, opts);\n\t\n\t\tconst fs = os.map((o, i) => {\n\t\t\tconst hash = calcHash(ifms[i].src);\n\t\t\tconst [frameInst, frame] = createIframeFrame(opts, ifms[i]);\n\t\t\tassignIframeOpenerStyle(o, opts['styleOpener']);\n\t\n\t\t\treturn { opener: o, hash, frameInst, frame, caption: null };\n\t\t});\n\t\tinitialize(fs, opts);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction createIframeFrame(opts, ifm) {\n\t\topts = Object.assign({\n\t\t\tstyleIframeFrame: ':ncFrameIframe',\n\t\t\tstyleLoaded     : ':ncLoaded',\n\t\t}, opts);\n\t\n\t\tconst src = filterSource(ifm.src);\n\t\n\t\tifm.removeAttribute('src');\n\t\tifm.setAttribute('data-nc-lazy', '');\n\t\tif (!ifm.style.aspectRatio) {\n\t\t\tconst [w, h] = extractIframeSize(ifm);\n\t\t\tif (w && h) {\n\t\t\t\tifm.style.aspectRatio = `${w} / ${h}`;\n\t\t\t}\n\t\t}\n\t\n\t\tconst inst = {\n\t\t\topts, src, ifm,\n\t\n\t\t\tscale    : 1,\n\t\t\trealScale: 1,\n\t\t\tbaseSize : null,\n\t\t\tisLs     : false,\n\t\t\tmargin   : 0,\n\t\n\t\t\tfrm: null,\n\t\t};\n\t\n\t\tinst.frm = document.createElement('div');\n\t\tsetClass(inst.frm, inst.opts.styleIframeFrame);\n\t\n\t\tinst.ifm.addEventListener('click', e => e.stopPropagation());\n\t\tinst.frm.appendChild(inst.ifm);\n\t\n\t\tinst['doResize'] = () => {};\n\t\tinst['doOpen']   = () => setSource(inst);\n\t\tinst['doClose']  = () => pause(inst);\n\t\treturn [inst, inst.frm];\n\t}\n\t\n\tfunction assignIframeOpenerStyle(o, styleOpener) {\n\t\tsetClass(o, styleOpener);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction setSource(inst) {\n\t\tconst ifm = inst.ifm;\n\t\tif (ifm.hasAttribute('data-nc-lazy')) {\n\t\t\tifm.removeAttribute('data-nc-lazy');\n\t\t\tifm.style.opacity = '0';\n\t\t\tifm.addEventListener('load', () => {\n\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\tsetTimeout(() => { ifm.style.opacity = '1'; }, 0);\n\t\t\t});\n\t\t\tifm.contentDocument.location.replace(inst.src);\n\t\t}\n\t}\n\t\n\tfunction pause(inst) {\n\t\tif (inst.src.startsWith('https://www.youtube.com')) {\n\t\t\tinst.ifm.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}', '*');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction filterSource(src) {\n\t\tif (src.startsWith('https://www.youtube.com')) {\n\t\t\tconst url = new URL(src);\n\t\t\tconst ps  = new URLSearchParams(url.search);\n\t\t\tps.append('enablejsapi', 1);\n\t\t\turl.search = ps;\n\t\t\tsrc = url.toString();\n\t\t}\n\t\treturn src;\n\t}\n\t\n\tfunction extractIframeSize(f) {\n\t\tlet w = parseInt(f.width);\n\t\tlet h = parseInt(f.height);\n\t\tif (w && h) return [w, h];\n\t\n\t\tconst sW = f.style.width;\n\t\tconst sH = f.style.height;\n\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\tw = parseInt(sW);\n\t\th = parseInt(sH);\n\t\tif (w && h) return [w, h];\n\t\treturn [0, 0];\n\t}\n\t\n\tNS.applyIframe = apply;\n\n\t/**\n\t *\n\t * Dialog\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-18\n\t *\n\t */\n\t\n\t\n\tfunction initialize(fs, opts = {}) {\n\t\tif (fs.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleRoot   : ':ncViewer',\n\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\tstyleCaption: ':ncViewerCaption',\n\t\n\t\t\tstyleOpen     : ':ncOpen',\n\t\t\tstyleVisible  : ':ncVisible',\n\t\t\tstyleInstantly: ':ncInstantly',\n\t\n\t\t\thashPrefix: 'viewer:',\n\t\t}, opts);\n\t\n\t\tconst is = fs.map(f => {\n\t\t\tconst inst = createViewer(opts, f.hash, f.frameInst, f.frame, f.caption);\n\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\treturn inst;\n\t\t});\n\t\tassignEventHandler(is);\n\t\tprocessHash(is, opts['hashPrefix']);\n\t}\n\t\n\tfunction assignEventHandler(is) {\n\t\tonResize(() => {\n\t\t\tfor (const inst of is) inst.fi.doResize();\n\t\t\tsetTimeout(() => { for (const inst of is) inst.fi.doResize(); }, 200);\n\t\t});\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\tconst cur = is[currentId];\n\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction processHash(is, hashPrefix) {\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tif (currentId !== null) doClose(is[currentId]);\n\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\tdoOpen(is[e.state['id']]);\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\tcheckHash(is, hashPrefix, location.hash);\n\t}\n\t\n\tfunction checkHash(is, hashPrefix, hash) {\n\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\tconst ih = hash.replace('#' + hashPrefix, '');\n\t\tif (!ih) return;\n\t\tfor (let i = 0; i < is.length; i += 1) {\n\t\t\tif (is[i].hash === ih) {\n\t\t\t\tif (currentId !== null && currentId !== i) doClose(is[currentId]);\n\t\t\t\tif (currentId === null || currentId !== i) doOpen(is[i]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet instanceCount = 0;\n\tlet prevInstance  = null;\n\tlet currentId     = null;\n\t\n\tfunction createViewer(opts, hash, frameInst, frame, caption = null) {\n\t\tconst inst = {};\n\t\tinst.opts = opts;\n\t\tinst.fi   = frameInst;\n\t\tinst.id   = instanceCount++;\n\t\tinst.hash = hash;\n\t\n\t\tinst.dlg = document.createElement('div');\n\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\tinst.dlg.appendChild(frame);\n\t\n\t\tconst btn = document.createElement('button');\n\t\tsetClass(btn, opts.styleCloser);\n\t\tinst.dlg.appendChild(btn);\n\t\n\t\tinst.btnPrev = document.createElement('button');\n\t\tinst.btnNext = document.createElement('button');\n\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\tinst.dlg.appendChild(inst.btnNext);\n\t\n\t\tif (caption) {\n\t\t\tconst divCap = document.createElement('div');\n\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\tinst.dlg.appendChild(divCap);\n\t\t}\n\t\tdocument.body.appendChild(inst.dlg);\n\t\n\t\t_setAdjacentInstance(inst, prevInstance);\n\t\tprevInstance = inst;\n\t\treturn inst;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction doOpen(inst, instantly = false) {\n\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\tinst.fi.doOpen();\n\t\n\t\tif (instantly) {\n\t\t\tinst.fi.doResize();\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\t\thistory.replaceState(null, '', url);\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t}, 0);\n\t\t}\n\t\tcurrentId = inst.id;\n\t}\n\t\n\tfunction doClose(inst, instantly = false) {\n\t\tinst.fi.doClose();\n\t\n\t\tif (instantly) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t} else {\n\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t}\n\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\tcurrentId = null;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction _setAdjacentInstance(inst, prev) {\n\t\tinst.btnNext.style.display = 'none';\n\t\tif (prev) {\n\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(prev, true);\n\t\t\t});\n\t\t\t_setNextInstance(prev, inst);\n\t\t} else {\n\t\t\tinst.btnPrev.style.display = 'none';\n\t\t}\n\t}\n\t\n\tfunction _setNextInstance(inst, next) {\n\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tdoClose(inst, true);\n\t\t\tdoOpen(next, true);\n\t\t});\n\t\tinst.btnNext.style.display = null;\n\t}\n\t\n\tfunction _onOpen(inst, e) {\n\t\te.preventDefault();\n\t\tdoOpen(inst);\n\t\n\t\tif (location.hash) {\n\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\thistory.replaceState(null, '', newUrl);\n\t\t}\n\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t}\n\t\n\tfunction _onClose(e) {\n\t\te.preventDefault();\n\t\thistory.back();\n\t}\n\t\n\n})(window['NACSS']['viewer']);\n"]}